2025-11-24T12:36:04.239-03:00  INFO 19716 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 19716 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T12:36:04.241-03:00  INFO 19716 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T12:36:04.602-03:00  INFO 19716 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T12:36:04.650-03:00  INFO 19716 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 39 ms. Found 5 JPA repository interfaces.
2025-11-24T12:36:05.201-03:00  INFO 19716 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T12:36:05.214-03:00  INFO 19716 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T12:36:05.215-03:00  INFO 19716 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T12:36:05.269-03:00  INFO 19716 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T12:36:05.269-03:00  INFO 19716 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 995 ms
2025-11-24T12:36:05.460-03:00  INFO 19716 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T12:36:05.661-03:00  INFO 19716 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2674d4f6
2025-11-24T12:36:05.662-03:00  INFO 19716 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T12:36:05.690-03:00  INFO 19716 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T12:36:05.749-03:00  INFO 19716 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.031s)
2025-11-24T12:36:05.867-03:00  INFO 19716 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 6
2025-11-24T12:36:05.870-03:00  INFO 19716 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Schema "cnpj" is up to date. No migration necessary.
2025-11-24T12:36:05.976-03:00  INFO 19716 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T12:36:06.019-03:00  INFO 19716 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T12:36:06.050-03:00  INFO 19716 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T12:36:06.284-03:00  INFO 19716 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T12:36:06.354-03:00  INFO 19716 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T12:36:07.175-03:00  INFO 19716 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T12:36:07.178-03:00  INFO 19716 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T12:36:07.858-03:00  INFO 19716 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T12:36:07.865-03:00  INFO 19716 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 3.985 seconds (process running for 4.606)
2025-11-24T12:36:46.245-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T12:36:46.246-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T12:36:46.248-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2025-11-24T12:36:59.531-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1763998615671, type=class java.lang.Long, identifying=true}'}]
2025-11-24T12:36:59.531-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1763998608119, type=class java.lang.Long, identifying=true}'}]
2025-11-24T12:37:00.214-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T12:37:00.414-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T12:37:00.954-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T12:37:00.958-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=5000000 | threads=4
2025-11-24T12:37:00.960-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_municipios
2025-11-24T12:37:00.961-03:00  INFO 19716 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T12:37:00.961-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T12:37:00.963-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=5000000 | threads=4
2025-11-24T12:37:00.963-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_cnaes
2025-11-24T12:37:00.963-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T12:37:00.963-03:00  INFO 19716 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T12:37:00.965-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=5000000 | threads=4
2025-11-24T12:37:00.966-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_paises
2025-11-24T12:37:00.967-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T12:37:00.967-03:00  INFO 19716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T12:37:00.969-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=5000000 | threads=4
2025-11-24T12:37:00.969-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_naturezas
2025-11-24T12:37:00.969-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T12:37:00.969-03:00  INFO 19716 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T12:37:00.972-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=5000000 | threads=4
2025-11-24T12:37:00.972-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_qualificacoes
2025-11-24T12:37:00.972-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T12:37:00.972-03:00  INFO 19716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T12:37:00.974-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=5000000 | threads=4
2025-11-24T12:37:00.975-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_motivos
2025-11-24T12:37:00.975-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T12:37:00.975-03:00  INFO 19716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T12:37:01.278-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T12:37:01.278-03:00  INFO 19716 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T12:37:01.278-03:00  INFO 19716 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T12:37:01.278-03:00  INFO 19716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T12:37:01.278-03:00  INFO 19716 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T12:37:01.282-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=5000000 | threads=4
2025-11-24T12:37:01.283-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_municipios
2025-11-24T12:37:01.283-03:00  INFO 19716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T12:37:01.283-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T12:37:01.285-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=5000000 | threads=4
2025-11-24T12:37:01.286-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_cnaes
2025-11-24T12:37:01.286-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T12:37:01.286-03:00  INFO 19716 --- [cnpj-batch] [pool-9-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-9-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T12:37:01.289-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=5000000 | threads=4
2025-11-24T12:37:01.289-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_paises
2025-11-24T12:37:01.289-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T12:37:01.290-03:00  INFO 19716 --- [cnpj-batch] [pool-10-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-10-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T12:37:01.292-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=5000000 | threads=4
2025-11-24T12:37:01.292-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_naturezas
2025-11-24T12:37:01.292-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T12:37:01.292-03:00  INFO 19716 --- [cnpj-batch] [pool-11-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-11-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T12:37:01.294-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=5000000 | threads=4
2025-11-24T12:37:01.295-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_qualificacoes
2025-11-24T12:37:01.295-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T12:37:01.295-03:00  INFO 19716 --- [cnpj-batch] [pool-12-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-12-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T12:37:01.297-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=5000000 | threads=4
2025-11-24T12:37:01.298-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_motivos
2025-11-24T12:37:01.298-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T12:37:01.298-03:00  INFO 19716 --- [cnpj-batch] [pool-13-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-13-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T12:37:01.447-03:00  INFO 19716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T12:37:01.655-03:00  INFO 19716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T12:37:31.300-03:00  WARN 19716 --- [cnpj-batch] [pool-12-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: null
2025-11-24T12:37:31.300-03:00  WARN 19716 --- [cnpj-batch] [pool-3-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: null
2025-11-24T12:37:31.300-03:00  WARN 19716 --- [cnpj-batch] [pool-5-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: null
2025-11-24T12:37:31.300-03:00  WARN 19716 --- [cnpj-batch] [pool-11-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: null
2025-11-24T12:37:31.301-03:00 ERROR 19716 --- [cnpj-batch] [pool-3-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : HikariPool-1 - Connection is not available, request timed out after 30005ms (total=10, active=10, idle=0, waiting=7)
2025-11-24T12:37:31.300-03:00  WARN 19716 --- [cnpj-batch] [pool-2-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: null
2025-11-24T12:37:31.300-03:00  WARN 19716 --- [cnpj-batch] [pool-10-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: null
2025-11-24T12:37:31.301-03:00 ERROR 19716 --- [cnpj-batch] [pool-12-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : HikariPool-1 - Connection is not available, request timed out after 30000ms (total=10, active=10, idle=0, waiting=7)
2025-11-24T12:37:31.301-03:00 ERROR 19716 --- [cnpj-batch] [pool-2-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : HikariPool-1 - Connection is not available, request timed out after 30005ms (total=10, active=10, idle=0, waiting=7)
2025-11-24T12:37:31.301-03:00 ERROR 19716 --- [cnpj-batch] [pool-10-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : HikariPool-1 - Connection is not available, request timed out after 30006ms (total=10, active=10, idle=0, waiting=6)
2025-11-24T12:37:31.301-03:00 ERROR 19716 --- [cnpj-batch] [pool-5-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : HikariPool-1 - Connection is not available, request timed out after 30005ms (total=10, active=10, idle=0, waiting=7)
2025-11-24T12:37:31.301-03:00 ERROR 19716 --- [cnpj-batch] [pool-11-thread-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : HikariPool-1 - Connection is not available, request timed out after 30003ms (total=10, active=10, idle=0, waiting=7)
2025-11-24T12:37:31.338-03:00  INFO 19716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T12:37:31.358-03:00  INFO 19716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T12:37:31.360-03:00  INFO 19716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 30393 ms (30 segundos)
2025-11-24T12:37:31.364-03:00  INFO 19716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T12:37:31.366-03:00  INFO 19716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 30391 ms (30 segundos)
2025-11-24T12:37:31.372-03:00  INFO 19716 --- [cnpj-batch] [pool-9-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T12:37:31.385-03:00  INFO 19716 --- [cnpj-batch] [pool-13-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T12:37:31.385-03:00 ERROR 19716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_qualificacoes_block bloco 0 - 67: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_qualificacoes_block(?, ?)]
2025-11-24T12:37:31.412-03:00 ERROR 19716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_municipios_block bloco 0 - 5571: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_municipios_block(?, ?)]
2025-11-24T12:37:31.412-03:00 ERROR 19716 --- [cnpj-batch] [pool-9-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_cnaes_block bloco 0 - 1358: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_cnaes_block(?, ?)]
2025-11-24T12:37:31.425-03:00  INFO 19716 --- [cnpj-batch] [pool-13-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T12:37:31.426-03:00  INFO 19716 --- [cnpj-batch] [pool-13-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-13-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 30128 ms (30 segundos)
2025-11-24T12:37:42.591-03:00  INFO 19716 --- [cnpj-batch] [RMI TCP Connection(11)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T12:37:42.594-03:00  INFO 19716 --- [cnpj-batch] [RMI TCP Connection(11)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T12:38:04.641-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=5000000 | threads=4
2025-11-24T12:38:04.642-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_empresa
2025-11-24T12:38:04.642-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 9999999]
2025-11-24T12:38:04.642-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 4999999]
2025-11-24T12:38:04.642-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [15000000 - 19999999]
2025-11-24T12:38:04.642-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_estabelecimento] para anoMes=2025-11
2025-11-24T12:38:04.642-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 14999999]
2025-11-24T12:38:04.663-03:00 ERROR 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Encountered an error executing step mergeStep in job cnpjJob

java.lang.NullPointerException: Cannot invoke "br.com.simplificarest.cnpjdomain.enm.CnpjFileType.getStageTable()" because the return value of "java.util.Map.get(Object)" is null
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$0(MergeOrchestrationService.java:51) ~[classes/:na]
	at java.base/java.lang.Iterable.forEach(Iterable.java:75) ~[na:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.executarTodos(MergeOrchestrationService.java:49) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.CnpjBatchJobConfig.lambda$2(CnpjBatchJobConfig.java:108) ~[classes/:na]
	at org.springframework.batch.core.step.tasklet.TaskletStep$ChunkTransactionCallback.doInTransaction(TaskletStep.java:383) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.step.tasklet.TaskletStep$ChunkTransactionCallback.doInTransaction(TaskletStep.java:307) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.batch.core.step.tasklet.TaskletStep$2.doInChunkContext(TaskletStep.java:250) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.scope.context.StepContextRepeatCallback.doInIteration(StepContextRepeatCallback.java:82) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.repeat.support.RepeatTemplate.getNextResult(RepeatTemplate.java:369) ~[spring-batch-infrastructure-5.2.4.jar:5.2.4]
	at org.springframework.batch.repeat.support.RepeatTemplate.executeInternal(RepeatTemplate.java:206) ~[spring-batch-infrastructure-5.2.4.jar:5.2.4]
	at org.springframework.batch.repeat.support.RepeatTemplate.iterate(RepeatTemplate.java:140) ~[spring-batch-infrastructure-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.step.tasklet.TaskletStep.doExecute(TaskletStep.java:235) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.step.AbstractStep.execute(AbstractStep.java:230) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.SimpleStepHandler.handleStep(SimpleStepHandler.java:153) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.AbstractJob.handleStep(AbstractJob.java:408) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.SimpleJob.doExecute(SimpleJob.java:127) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.AbstractJob.execute(AbstractJob.java:307) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.launch.support.TaskExecutorJobLauncher$1.run(TaskExecutorJobLauncher.java:155) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.core.task.SyncTaskExecutor.execute(SyncTaskExecutor.java:48) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.batch.core.launch.support.TaskExecutorJobLauncher.run(TaskExecutorJobLauncher.java:146) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at br.com.simplificarest.cnpjbatch.controller.BatchController.run(BatchController.java:37) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2025-11-24T12:38:04.667-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 1m4s452ms
2025-11-24T12:38:04.669-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 9999999
2025-11-24T12:38:04.684-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 4999999
2025-11-24T12:38:04.684-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 15000000 - 19999999
2025-11-24T12:38:04.684-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 14999999
2025-11-24T12:38:04.688-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 5000000 - 9999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.690-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 24999999]
2025-11-24T12:38:04.714-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=5000000 | threads=4
2025-11-24T12:38:04.715-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 4999999]
2025-11-24T12:38:04.715-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_empresa
2025-11-24T12:38:04.715-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_estabelecimento] para anoMes=2025-11
2025-11-24T12:38:04.715-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 14999999]
2025-11-24T12:38:04.716-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [15000000 - 19999999]
2025-11-24T12:38:04.716-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 9999999]
2025-11-24T12:38:04.718-03:00 ERROR 19716 --- [cnpj-batch] [http-nio-8080-exec-4] o.s.batch.core.step.AbstractStep         : Encountered an error executing step mergeStep in job cnpjJob

java.lang.NullPointerException: Cannot invoke "br.com.simplificarest.cnpjdomain.enm.CnpjFileType.getStageTable()" because the return value of "java.util.Map.get(Object)" is null
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$0(MergeOrchestrationService.java:51) ~[classes/:na]
	at java.base/java.lang.Iterable.forEach(Iterable.java:75) ~[na:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.executarTodos(MergeOrchestrationService.java:49) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.CnpjBatchJobConfig.lambda$2(CnpjBatchJobConfig.java:108) ~[classes/:na]
	at org.springframework.batch.core.step.tasklet.TaskletStep$ChunkTransactionCallback.doInTransaction(TaskletStep.java:383) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.step.tasklet.TaskletStep$ChunkTransactionCallback.doInTransaction(TaskletStep.java:307) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.batch.core.step.tasklet.TaskletStep$2.doInChunkContext(TaskletStep.java:250) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.scope.context.StepContextRepeatCallback.doInIteration(StepContextRepeatCallback.java:82) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.repeat.support.RepeatTemplate.getNextResult(RepeatTemplate.java:369) ~[spring-batch-infrastructure-5.2.4.jar:5.2.4]
	at org.springframework.batch.repeat.support.RepeatTemplate.executeInternal(RepeatTemplate.java:206) ~[spring-batch-infrastructure-5.2.4.jar:5.2.4]
	at org.springframework.batch.repeat.support.RepeatTemplate.iterate(RepeatTemplate.java:140) ~[spring-batch-infrastructure-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.step.tasklet.TaskletStep.doExecute(TaskletStep.java:235) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.step.AbstractStep.execute(AbstractStep.java:230) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.SimpleStepHandler.handleStep(SimpleStepHandler.java:153) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.AbstractJob.handleStep(AbstractJob.java:408) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.SimpleJob.doExecute(SimpleJob.java:127) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.job.AbstractJob.execute(AbstractJob.java:307) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.batch.core.launch.support.TaskExecutorJobLauncher$1.run(TaskExecutorJobLauncher.java:155) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at org.springframework.core.task.SyncTaskExecutor.execute(SyncTaskExecutor.java:48) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.batch.core.launch.support.TaskExecutorJobLauncher.run(TaskExecutorJobLauncher.java:146) ~[spring-batch-core-5.2.4.jar:5.2.4]
	at br.com.simplificarest.cnpjbatch.controller.BatchController.run(BatchController.java:37) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.12.jar:6.2.12]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.48.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.12.jar:6.2.12]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.12.jar:6.2.12]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.48.jar:10.1.48]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2025-11-24T12:38:04.720-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 1m4s305ms
2025-11-24T12:38:04.725-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 20000000 - 24999999
2025-11-24T12:38:04.725-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 10000000 - 14999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.725-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 15000000 - 19999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.725-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 0 - 4999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.727-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [25000000 - 29999999]
2025-11-24T12:38:04.727-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [30000000 - 34999999]
2025-11-24T12:38:04.728-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [35000000 - 39999999]
2025-11-24T12:38:04.731-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 14999999
2025-11-24T12:38:04.745-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 4999999
2025-11-24T12:38:04.745-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 9999999
2025-11-24T12:38:04.746-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 20000000 - 24999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.748-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [40000000 - 44999999]
2025-11-24T12:38:04.752-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 15000000 - 19999999
2025-11-24T12:38:04.765-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1763998608119, type=class java.lang.Long, identifying=true}'}] and the following status: [FAILED] in 1m5s186ms
2025-11-24T12:38:04.767-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 30000000 - 34999999
2025-11-24T12:38:04.767-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 10000000 - 14999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.768-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 24999999]
2025-11-24T12:38:04.772-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 25000000 - 29999999
2025-11-24T12:38:04.775-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 35000000 - 39999999
2025-11-24T12:38:04.792-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 5000000 - 9999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.792-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 0 - 4999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.794-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [30000000 - 34999999]
2025-11-24T12:38:04.794-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [25000000 - 29999999]
2025-11-24T12:38:04.799-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 15000000 - 19999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.801-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [35000000 - 39999999]
2025-11-24T12:38:04.802-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 40000000 - 44999999
2025-11-24T12:38:04.806-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 30000000 - 34999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.805-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 25000000 - 29999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.807-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [45000000 - 49999999]
2025-11-24T12:38:04.807-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [50000000 - 54999999]
2025-11-24T12:38:04.811-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 35000000 - 39999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.811-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 20000000 - 24999999
2025-11-24T12:38:04.814-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [55000000 - 59999999]
2025-11-24T12:38:04.818-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 40000000 - 44999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.820-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 30000000 - 34999999
2025-11-24T12:38:04.820-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [60000000 - 64999999]
2025-11-24T12:38:04.820-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 25000000 - 29999999
2025-11-24T12:38:04.820-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 35000000 - 39999999
2025-11-24T12:38:04.829-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 45000000 - 49999999
2025-11-24T12:38:04.832-03:00  INFO 19716 --- [cnpj-batch] [http-nio-8080-exec-4] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1763998615671, type=class java.lang.Long, identifying=true}'}] and the following status: [FAILED] in 1m5s267ms
2025-11-24T12:38:04.846-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 20000000 - 24999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.848-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 50000000 - 54999999
2025-11-24T12:38:04.848-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [40000000 - 44999999]
2025-11-24T12:38:04.849-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 55000000 - 59999999
2025-11-24T12:38:04.858-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 25000000 - 29999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.859-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [45000000 - 49999999]
2025-11-24T12:38:04.860-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 35000000 - 39999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.860-03:00 ERROR 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 30000000 - 34999999: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_empresa_block(?, ?)]
2025-11-24T12:38:04.862-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [50000000 - 54999999]
2025-11-24T12:38:04.864-03:00  INFO 19716 --- [cnpj-batch] [pool-15-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-15-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [55000000 - 59999999]
2025-11-24T12:38:04.870-03:00  INFO 19716 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-24T12:38:04.875-03:00  INFO 19716 --- [cnpj-batch] [RMI TCP Connection(11)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T12:38:04.877-03:00  INFO 19716 --- [cnpj-batch] [RMI TCP Connection(11)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T12:38:04.877-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 60000000 - 64999999
2025-11-24T12:38:04.881-03:00  INFO 19716 --- [cnpj-batch] [RMI TCP Connection(11)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T12:38:04.879-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-2] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@70104fb7 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.ensureOpenAndConnected(NioSocketImpl.java:163) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.beginRead(NioSocketImpl.java:226) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:294) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T12:38:04.880-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-3] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@41143933 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:330) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.executeTransactionCommand(PgConnection.java:987) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.commit(PgConnection.java:1009) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.commit(ProxyConnection.java:378) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.commit(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.commit(AbstractLogicalConnectionImplementor.java:87) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:268) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:563) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:698) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:416) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 34 common frames omitted

2025-11-24T12:38:04.881-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-1] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@576c0b1c marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:330) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.executeTransactionCommand(PgConnection.java:987) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.commit(PgConnection.java:1009) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.commit(ProxyConnection.java:378) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.commit(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.commit(AbstractLogicalConnectionImplementor.java:87) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:268) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:563) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:698) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:416) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 34 common frames omitted

2025-11-24T12:38:04.884-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-4] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@9435b99 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:330) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.executeTransactionCommand(PgConnection.java:987) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.commit(PgConnection.java:1009) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.commit(ProxyConnection.java:378) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.commit(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.commit(AbstractLogicalConnectionImplementor.java:87) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:268) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:563) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:698) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:416) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 34 common frames omitted

2025-11-24T12:38:04.888-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-2] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T12:38:04.890-03:00  INFO 19716 --- [cnpj-batch] [pool-14-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-14-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [65000000 - 65277299]
2025-11-24T12:38:04.893-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-1] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@6e29bd02 marked as broken because of SQLSTATE(08003), ErrorCode(0)

org.postgresql.util.PSQLException: This connection has been closed.
	at org.postgresql.jdbc.PgConnection.checkClosed(PgConnection.java:1015) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.rollback(PgConnection.java:1022) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:386) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:289) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:590) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:897) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:866) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.completeTransactionAfterThrowing(TransactionAspectSupport.java:716) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2025-11-24T12:38:04.893-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-3] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@23c42ca0 marked as broken because of SQLSTATE(08003), ErrorCode(0)

org.postgresql.util.PSQLException: This connection has been closed.
	at org.postgresql.jdbc.PgConnection.checkClosed(PgConnection.java:1015) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.rollback(PgConnection.java:1022) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:386) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:289) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:590) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:897) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:866) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.completeTransactionAfterThrowing(TransactionAspectSupport.java:716) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2025-11-24T12:38:04.893-03:00  WARN 19716 --- [cnpj-batch] [pool-14-thread-4] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@7974782f marked as broken because of SQLSTATE(08003), ErrorCode(0)

org.postgresql.util.PSQLException: This connection has been closed.
	at org.postgresql.jdbc.PgConnection.checkClosed(PgConnection.java:1015) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.rollback(PgConnection.java:1022) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:386) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:289) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:590) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:897) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:866) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.completeTransactionAfterThrowing(TransactionAspectSupport.java:716) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2025-11-24T12:38:04.893-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-3] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.dao.DataAccessResourceFailureException: Hibernate transaction: Unable to commit against JDBC Connection; An I/O error occurred while sending to the backend.
	at org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.doTranslate(SQLStateSQLExceptionTranslator.java:152) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:116) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:269) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:256) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:567) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:698) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:416) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:330) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.executeTransactionCommand(PgConnection.java:987) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.commit(PgConnection.java:1009) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.commit(ProxyConnection.java:378) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.commit(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.commit(AbstractLogicalConnectionImplementor.java:87) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:268) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:563) ~[spring-orm-6.2.12.jar:6.2.12]
	... 25 common frames omitted
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 34 common frames omitted

2025-11-24T12:38:04.893-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-1] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.dao.DataAccessResourceFailureException: Hibernate transaction: Unable to commit against JDBC Connection; An I/O error occurred while sending to the backend.
	at org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.doTranslate(SQLStateSQLExceptionTranslator.java:152) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:116) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:269) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:256) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:567) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:698) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:416) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:330) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.executeTransactionCommand(PgConnection.java:987) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.commit(PgConnection.java:1009) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.commit(ProxyConnection.java:378) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.commit(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.commit(AbstractLogicalConnectionImplementor.java:87) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:268) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:563) ~[spring-orm-6.2.12.jar:6.2.12]
	... 25 common frames omitted
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 34 common frames omitted

2025-11-24T12:38:04.894-03:00 ERROR 19716 --- [cnpj-batch] [pool-14-thread-4] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.dao.DataAccessResourceFailureException: Hibernate transaction: Unable to commit against JDBC Connection; An I/O error occurred while sending to the backend.
	at org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.doTranslate(SQLStateSQLExceptionTranslator.java:152) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:116) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:269) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:256) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:567) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:698) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:416) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:330) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.executeTransactionCommand(PgConnection.java:987) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgConnection.commit(PgConnection.java:1009) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyConnection.commit(ProxyConnection.java:378) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.commit(HikariProxyConnection.java) ~[HikariCP-6.3.3.jar:na]
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.commit(AbstractLogicalConnectionImplementor.java:87) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:268) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:563) ~[spring-orm-6.2.12.jar:6.2.12]
	... 25 common frames omitted
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 34 common frames omitted

2025-11-24T13:42:30.540-03:00  INFO 13024 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 13024 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T13:42:30.563-03:00  INFO 13024 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T13:42:30.895-03:00  INFO 13024 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T13:42:30.939-03:00  INFO 13024 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 36 ms. Found 5 JPA repository interfaces.
2025-11-24T13:42:31.480-03:00  INFO 13024 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T13:42:31.493-03:00  INFO 13024 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T13:42:31.493-03:00  INFO 13024 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T13:42:31.542-03:00  INFO 13024 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T13:42:31.542-03:00  INFO 13024 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 948 ms
2025-11-24T13:42:31.716-03:00  INFO 13024 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T13:42:31.946-03:00  INFO 13024 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2a484710
2025-11-24T13:42:31.948-03:00  INFO 13024 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T13:42:31.975-03:00  INFO 13024 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T13:42:32.116-03:00  INFO 13024 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.108s)
2025-11-24T13:42:32.153-03:00  INFO 13024 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 1
2025-11-24T13:42:32.170-03:00  INFO 13024 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "2 - create final tables"
2025-11-24T13:42:32.191-03:00 ERROR 13024 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migration of schema "cnpj" to version "2 - create final tables" failed! Changes successfully rolled back.
2025-11-24T13:42:32.203-03:00  WARN 13024 --- [cnpj-batch] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V2__create_final_tables.sql failed
-----------------------------------------
SQL State  : 42P07
Error Code : 0
Message    : ERROR: relation "empresa" already exists
Location   : db/migration/V2__create_final_tables.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V2__create_final_tables.sql)
Line       : 7
Statement  : Run Flyway with -X option to see the actual statement causing the problem

2025-11-24T13:42:32.204-03:00  INFO 13024 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T13:42:32.312-03:00  INFO 13024 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T13:42:32.314-03:00  INFO 13024 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-11-24T13:42:32.323-03:00  INFO 13024 --- [cnpj-batch] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-11-24T13:42:32.338-03:00 ERROR 13024 --- [cnpj-batch] [main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V2__create_final_tables.sql failed
-----------------------------------------
SQL State  : 42P07
Error Code : 0
Message    : ERROR: relation "empresa" already exists
Location   : db/migration/V2__create_final_tables.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V2__create_final_tables.sql)
Line       : 7
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:328) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:973) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.5.7.jar:3.5.7]
	at br.com.simplificarest.cnpjbatch.CnpjBatchApplication.main(CnpjBatchApplication.java:12) ~[classes/:na]
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V2__create_final_tables.sql failed
-----------------------------------------
SQL State  : 42P07
Error Code : 0
Message    : ERROR: relation "empresa" already exists
Location   : db/migration/V2__create_final_tables.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V2__create_final_tables.sql)
Line       : 7
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315) ~[spring-beans-6.2.12.jar:6.2.12]
	... 10 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V2__create_final_tables.sql failed
-----------------------------------------
SQL State  : 42P07
Error Code : 0
Message    : ERROR: relation "empresa" already exists
Location   : db/migration/V2__create_final_tables.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V2__create_final_tables.sql)
Line       : 7
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:200) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.12.jar:6.2.12]
	... 20 common frames omitted
Caused by: org.flywaydb.core.internal.exception.FlywayMigrateException: Script V2__create_final_tables.sql failed
-----------------------------------------
SQL State  : 42P07
Error Code : 0
Message    : ERROR: relation "empresa" already exists
Location   : db/migration/V2__create_final_tables.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V2__create_final_tables.sql)
Line       : 7
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:399) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:283) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:282) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:255) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:77) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.lambda$execute$0(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLConnection.lock(PostgreSQLConnection.java:105) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:164) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:104) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.lambda$migrate$1(Flyway.java:247) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:210) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:188) ~[flyway-core-11.7.2.jar:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig.flyway(FlywayConfig.java:21) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.CGLIB$flyway$0(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>) ~[classes/:na]
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400) ~[spring-context-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.flyway(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172) ~[spring-beans-6.2.12.jar:6.2.12]
	... 23 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Script V2__create_final_tables.sql failed
-----------------------------------------
SQL State  : 42P07
Error Code : 0
Message    : ERROR: relation "empresa" already exists
Location   : db/migration/V2__create_final_tables.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V2__create_final_tables.sql)
Line       : 7
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:256) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:217) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:137) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:75) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:66) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:31) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:65) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:391) ~[flyway-core-11.7.2.jar:na]
	... 48 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: relation "empresa" already exists
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2736) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2421) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:357) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:342) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:318) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:313) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:95) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:215) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:88) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:212) ~[flyway-core-11.7.2.jar:na]
	... 54 common frames omitted

2025-11-24T13:42:58.169-03:00  INFO 16552 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 16552 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T13:42:58.170-03:00  INFO 16552 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T13:42:58.495-03:00  INFO 16552 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T13:42:58.543-03:00  INFO 16552 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 41 ms. Found 5 JPA repository interfaces.
2025-11-24T13:42:59.052-03:00  INFO 16552 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T13:42:59.063-03:00  INFO 16552 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T13:42:59.063-03:00  INFO 16552 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T13:42:59.113-03:00  INFO 16552 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T13:42:59.113-03:00  INFO 16552 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 908 ms
2025-11-24T13:42:59.282-03:00  INFO 16552 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T13:42:59.469-03:00  INFO 16552 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@370c7cc5
2025-11-24T13:42:59.470-03:00  INFO 16552 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T13:42:59.496-03:00  INFO 16552 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T13:42:59.552-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.027s)
2025-11-24T13:42:59.660-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 1
2025-11-24T13:42:59.674-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "2 - create final tables"
2025-11-24T13:42:59.818-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "3 - create indexes constraints"
2025-11-24T13:42:59.862-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "4 - batch process control"
2025-11-24T13:42:59.868-03:00  WARN 16552 --- [cnpj-batch] [main] o.f.c.i.s.DefaultSqlScriptExecutor       : DB: relation "controle_processos" already exists, skipping (SQL State: 42P07 - Error Code: 0)
2025-11-24T13:42:59.885-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "5 - create final tables cadastro"
2025-11-24T13:42:59.972-03:00  INFO 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T13:43:00.005-03:00 ERROR 16552 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migration of schema "cnpj" to version "6 - create merge procedures block" failed! Changes successfully rolled back.
2025-11-24T13:43:00.016-03:00  WARN 16552 --- [cnpj-batch] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

2025-11-24T13:43:00.016-03:00  INFO 16552 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T13:43:00.096-03:00  INFO 16552 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T13:43:00.097-03:00  INFO 16552 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-11-24T13:43:00.108-03:00  INFO 16552 --- [cnpj-batch] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-11-24T13:43:00.124-03:00 ERROR 16552 --- [cnpj-batch] [main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:328) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:973) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.5.7.jar:3.5.7]
	at br.com.simplificarest.cnpjbatch.CnpjBatchApplication.main(CnpjBatchApplication.java:12) ~[classes/:na]
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315) ~[spring-beans-6.2.12.jar:6.2.12]
	... 10 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:200) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.12.jar:6.2.12]
	... 20 common frames omitted
Caused by: org.flywaydb.core.internal.exception.FlywayMigrateException: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:399) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:283) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:282) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:255) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:77) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.lambda$execute$0(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLConnection.lock(PostgreSQLConnection.java:105) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:164) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:104) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.lambda$migrate$1(Flyway.java:247) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:210) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:188) ~[flyway-core-11.7.2.jar:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig.flyway(FlywayConfig.java:21) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.CGLIB$flyway$0(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>) ~[classes/:na]
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400) ~[spring-context-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.flyway(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172) ~[spring-beans-6.2.12.jar:6.2.12]
	... 23 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:256) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:217) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:137) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:75) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:66) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:31) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:65) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:391) ~[flyway-core-11.7.2.jar:na]
	... 48 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: syntax error at or near "WHERE"
  Posição: 518
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2736) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2421) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:357) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:342) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:318) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:313) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:95) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:215) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:88) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:212) ~[flyway-core-11.7.2.jar:na]
	... 54 common frames omitted

2025-11-24T13:54:48.697-03:00  INFO 10868 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 10868 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T13:54:48.698-03:00  INFO 10868 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T13:54:49.029-03:00  INFO 10868 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T13:54:49.077-03:00  INFO 10868 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 39 ms. Found 5 JPA repository interfaces.
2025-11-24T13:54:49.691-03:00  INFO 10868 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T13:54:49.703-03:00  INFO 10868 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T13:54:49.703-03:00  INFO 10868 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T13:54:49.749-03:00  INFO 10868 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T13:54:49.750-03:00  INFO 10868 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1020 ms
2025-11-24T13:54:49.950-03:00  INFO 10868 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T13:54:50.129-03:00  INFO 10868 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1216eb3f
2025-11-24T13:54:50.130-03:00  INFO 10868 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T13:54:50.154-03:00  INFO 10868 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T13:54:50.226-03:00  INFO 10868 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.046s)
2025-11-24T13:54:50.332-03:00  INFO 10868 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T13:54:50.358-03:00  INFO 10868 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T13:54:50.391-03:00 ERROR 10868 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migration of schema "cnpj" to version "6 - create merge procedures block" failed! Changes successfully rolled back.
2025-11-24T13:54:50.401-03:00  WARN 10868 --- [cnpj-batch] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

2025-11-24T13:54:50.401-03:00  INFO 10868 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T13:54:50.485-03:00  INFO 10868 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T13:54:50.487-03:00  INFO 10868 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-11-24T13:54:50.498-03:00  INFO 10868 --- [cnpj-batch] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-11-24T13:54:50.512-03:00 ERROR 10868 --- [cnpj-batch] [main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:328) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:973) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.5.7.jar:3.5.7]
	at br.com.simplificarest.cnpjbatch.CnpjBatchApplication.main(CnpjBatchApplication.java:12) ~[classes/:na]
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315) ~[spring-beans-6.2.12.jar:6.2.12]
	... 10 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:200) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.12.jar:6.2.12]
	... 20 common frames omitted
Caused by: org.flywaydb.core.internal.exception.FlywayMigrateException: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:399) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:283) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:282) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:255) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:77) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.lambda$execute$0(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLConnection.lock(PostgreSQLConnection.java:105) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:164) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:104) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.lambda$migrate$1(Flyway.java:247) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:210) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:188) ~[flyway-core-11.7.2.jar:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig.flyway(FlywayConfig.java:21) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.CGLIB$flyway$0(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>) ~[classes/:na]
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400) ~[spring-context-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.flyway(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172) ~[spring-beans-6.2.12.jar:6.2.12]
	... 23 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near "WHERE"
  Posição: 518
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:256) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:217) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:137) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:75) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:66) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:31) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:65) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:391) ~[flyway-core-11.7.2.jar:na]
	... 48 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: syntax error at or near "WHERE"
  Posição: 518
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2736) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2421) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:357) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:342) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:318) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:313) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:95) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:215) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:88) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:212) ~[flyway-core-11.7.2.jar:na]
	... 54 common frames omitted

2025-11-24T14:02:36.484-03:00  INFO 20268 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 20268 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T14:02:36.486-03:00  INFO 20268 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T14:02:36.822-03:00  INFO 20268 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T14:02:36.871-03:00  INFO 20268 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 41 ms. Found 5 JPA repository interfaces.
2025-11-24T14:02:37.391-03:00  INFO 20268 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T14:02:37.402-03:00  INFO 20268 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T14:02:37.402-03:00  INFO 20268 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T14:02:37.459-03:00  INFO 20268 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T14:02:37.459-03:00  INFO 20268 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 936 ms
2025-11-24T14:02:37.643-03:00  INFO 20268 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T14:02:37.835-03:00  INFO 20268 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2eb1c615
2025-11-24T14:02:37.837-03:00  INFO 20268 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T14:02:37.861-03:00  INFO 20268 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T14:02:37.927-03:00  INFO 20268 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.041s)
2025-11-24T14:02:38.038-03:00  INFO 20268 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T14:02:38.065-03:00  INFO 20268 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T14:02:38.097-03:00 ERROR 20268 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migration of schema "cnpj" to version "6 - create merge procedures block" failed! Changes successfully rolled back.
2025-11-24T14:02:38.107-03:00  WARN 20268 --- [cnpj-batch] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near ","
  Posição: 790
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

2025-11-24T14:02:38.107-03:00  INFO 20268 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T14:02:38.200-03:00  INFO 20268 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T14:02:38.203-03:00  INFO 20268 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-11-24T14:02:38.212-03:00  INFO 20268 --- [cnpj-batch] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-11-24T14:02:38.226-03:00 ERROR 20268 --- [cnpj-batch] [main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near ","
  Posição: 790
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:328) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:973) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.5.7.jar:3.5.7]
	at br.com.simplificarest.cnpjbatch.CnpjBatchApplication.main(CnpjBatchApplication.java:12) ~[classes/:na]
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near ","
  Posição: 790
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315) ~[spring-beans-6.2.12.jar:6.2.12]
	... 10 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near ","
  Posição: 790
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:200) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.12.jar:6.2.12]
	... 20 common frames omitted
Caused by: org.flywaydb.core.internal.exception.FlywayMigrateException: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near ","
  Posição: 790
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:399) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:283) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:282) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:255) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:77) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.lambda$execute$0(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:59) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:60) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.database.postgresql.PostgreSQLConnection.lock(PostgreSQLConnection.java:105) ~[flyway-database-postgresql-11.7.2.jar:na]
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:164) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:153) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:104) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.lambda$migrate$1(Flyway.java:247) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:210) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:188) ~[flyway-core-11.7.2.jar:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig.flyway(FlywayConfig.java:21) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.CGLIB$flyway$0(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>) ~[classes/:na]
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400) ~[spring-context-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.flyway(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172) ~[spring-beans-6.2.12.jar:6.2.12]
	... 23 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Script V6__create_merge_procedures_block.sql failed
---------------------------------------------------
SQL State  : 42601
Error Code : 0
Message    : ERROR: syntax error at or near ","
  Posição: 790
Location   : db/migration/V6__create_merge_procedures_block.sql (D:\DEV\projeto cnpj\cnpj-batch\target\classes\db\migration\V6__create_merge_procedures_block.sql)
Line       : 484
Statement  : Run Flyway with -X option to see the actual statement causing the problem

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:256) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:217) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:137) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:75) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:66) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:31) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:65) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:391) ~[flyway-core-11.7.2.jar:na]
	... 48 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: syntax error at or near ","
  Posição: 790
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2736) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2421) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:357) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:342) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:318) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:313) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:95) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:215) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:88) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:212) ~[flyway-core-11.7.2.jar:na]
	... 54 common frames omitted

2025-11-24T14:03:46.412-03:00  INFO 12460 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 12460 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T14:03:46.414-03:00  INFO 12460 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T14:03:46.742-03:00  INFO 12460 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T14:03:46.785-03:00  INFO 12460 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 35 ms. Found 5 JPA repository interfaces.
2025-11-24T14:03:47.281-03:00  INFO 12460 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T14:03:47.292-03:00  INFO 12460 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T14:03:47.292-03:00  INFO 12460 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T14:03:47.343-03:00  INFO 12460 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T14:03:47.343-03:00  INFO 12460 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 898 ms
2025-11-24T14:03:47.517-03:00  INFO 12460 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T14:03:47.711-03:00  INFO 12460 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@274fdea6
2025-11-24T14:03:47.712-03:00  INFO 12460 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T14:03:47.740-03:00  INFO 12460 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T14:03:47.806-03:00  INFO 12460 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.040s)
2025-11-24T14:03:47.917-03:00  INFO 12460 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T14:03:47.941-03:00  INFO 12460 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T14:03:48.009-03:00  INFO 12460 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema "cnpj", now at version v6 (execution time 00:00.023s)
2025-11-24T14:03:48.144-03:00  INFO 12460 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T14:03:48.207-03:00  INFO 12460 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T14:03:48.244-03:00  INFO 12460 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T14:03:48.505-03:00  INFO 12460 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T14:03:48.582-03:00  INFO 12460 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T14:03:49.399-03:00  INFO 12460 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T14:03:49.401-03:00  INFO 12460 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:03:50.130-03:00  INFO 12460 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T14:03:50.137-03:00  INFO 12460 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 4.049 seconds (process running for 4.653)
2025-11-24T14:04:32.409-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T14:04:32.409-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T14:04:32.410-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-11-24T14:04:32.518-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764003872474, type=class java.lang.Long, identifying=true}'}]
2025-11-24T14:04:32.558-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T14:04:32.575-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T14:04:32.581-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=5000000 | threads=4
2025-11-24T14:04:32.583-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_cnaes
2025-11-24T14:04:32.583-03:00  INFO 12460 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T14:04:32.583-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T14:04:32.588-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=5000000 | threads=4
2025-11-24T14:04:32.589-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_motivos
2025-11-24T14:04:32.589-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T14:04:32.589-03:00  INFO 12460 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T14:04:32.595-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=5000000 | threads=4
2025-11-24T14:04:32.595-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_municipios
2025-11-24T14:04:32.595-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T14:04:32.596-03:00  INFO 12460 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T14:04:32.598-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=5000000 | threads=4
2025-11-24T14:04:32.599-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_naturezas
2025-11-24T14:04:32.599-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T14:04:32.599-03:00  INFO 12460 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T14:04:32.604-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=5000000 | threads=4
2025-11-24T14:04:32.604-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_paises
2025-11-24T14:04:32.604-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T14:04:32.604-03:00  INFO 12460 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T14:04:32.608-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=5000000 | threads=4
2025-11-24T14:04:32.609-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_qualificacoes
2025-11-24T14:04:32.609-03:00  INFO 12460 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T14:04:32.609-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T14:04:32.687-03:00  INFO 12460 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T14:04:32.687-03:00  INFO 12460 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T14:04:32.700-03:00  INFO 12460 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T14:04:32.700-03:00  INFO 12460 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T14:04:32.715-03:00  INFO 12460 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T14:04:32.731-03:00  INFO 12460 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T14:04:32.772-03:00 ERROR 12460 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_cnaes_block bloco 0 - 1358: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_cnaes_block(?, ?)]
2025-11-24T14:04:32.772-03:00 ERROR 12460 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_naturezas_block bloco 0 - 90: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_naturezas_block(?, ?)]
2025-11-24T14:04:32.779-03:00 ERROR 12460 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_motivos_block bloco 0 - 62: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_motivos_block(?, ?)]
2025-11-24T14:04:32.786-03:00 ERROR 12460 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_paises_block bloco 0 - 254: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_paises_block(?, ?)]
2025-11-24T14:04:32.789-03:00 ERROR 12460 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_qualificacoes_block bloco 0 - 67: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_qualificacoes_block(?, ?)]
2025-11-24T14:04:32.823-03:00  INFO 12460 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T14:04:32.837-03:00  INFO 12460 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 241 ms (0 segundos)
2025-11-24T14:05:25.863-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=5000000 | threads=4
2025-11-24T14:05:25.863-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 4999999]
2025-11-24T14:05:25.863-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 9999999]
2025-11-24T14:05:25.864-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 14999999]
2025-11-24T14:05:25.864-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_empresa
2025-11-24T14:05:25.864-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [15000000 - 19999999]
2025-11-24T14:05:25.874-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 53s315ms
2025-11-24T14:05:25.886-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 14999999
2025-11-24T14:05:25.886-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 15000000 - 19999999
2025-11-24T14:05:25.886-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 4999999
2025-11-24T14:05:25.888-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 9999999
2025-11-24T14:05:25.918-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [cleanupStep]
2025-11-24T14:05:25.937-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [cleanupStep] executed in 19ms
2025-11-24T14:05:25.966-03:00  INFO 12460 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764003872474, type=class java.lang.Long, identifying=true}'}] and the following status: [COMPLETED] in 53s430ms
2025-11-24T14:05:26.302-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 15000000 - 19999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(48b01055b03c875d6bcee1e04f5fa3b6) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:26.304-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 24999999]
2025-11-24T14:05:26.336-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 20000000 - 24999999
2025-11-24T14:05:26.466-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 0 - 4999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:26.466-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 5000000 - 9999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(6fb808ae53be0a6670292388eeb07301) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:26.468-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [25000000 - 29999999]
2025-11-24T14:05:26.469-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [30000000 - 34999999]
2025-11-24T14:05:26.498-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 25000000 - 29999999
2025-11-24T14:05:26.498-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 30000000 - 34999999
2025-11-24T14:05:26.720-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 10000000 - 14999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(8bcb30fcfb876cb00470f0d6544549ed) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:26.722-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [35000000 - 39999999]
2025-11-24T14:05:26.733-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 35000000 - 39999999
2025-11-24T14:05:26.942-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 30000000 - 34999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(d24f6273cbfa4552bee33681918dc66a) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:26.944-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [40000000 - 44999999]
2025-11-24T14:05:26.966-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 40000000 - 44999999
2025-11-24T14:05:27.296-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 35000000 - 39999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(9b436453f97a3154337059ef946e83d9) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:27.298-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [45000000 - 49999999]
2025-11-24T14:05:27.314-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 40000000 - 44999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(c59b7595740a504c0df0cb7e35167847) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:27.316-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [50000000 - 54999999]
2025-11-24T14:05:27.320-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 45000000 - 49999999
2025-11-24T14:05:27.324-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 50000000 - 54999999
2025-11-24T14:05:27.620-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 50000000 - 54999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(03533e7fb352eaaefa481ef857aa9b3d) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:27.622-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [55000000 - 59999999]
2025-11-24T14:05:27.648-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 55000000 - 59999999
2025-11-24T14:05:28.193-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 55000000 - 59999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(964e41f06006c1a5969fd51de7e35729) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:28.195-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [60000000 - 64999999]
2025-11-24T14:05:28.212-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 60000000 - 64999999
2025-11-24T14:05:28.264-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 45000000 - 49999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(5a31ebcb34c4b2eae0ce634eb7177551) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:28.265-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [65000000 - 65277299]
2025-11-24T14:05:28.280-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 60000000 - 64999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(60ba5390ff0d9cff342e2c2c0752ec8b) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:28.287-03:00  INFO 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 65000000 - 65277299
2025-11-24T14:05:28.553-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 65000000 - 65277299: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:28.763-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 25000000 - 29999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(64c3b58b90343e2dcdd214298b487688) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:05:28.763-03:00 ERROR 12460 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 20000000 - 24999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(b6ef2ccdc0eb3943230f0e79b6a8ae2d) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:23:20.895-03:00  INFO 12460 --- [cnpj-batch] [RMI TCP Connection(30)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T14:23:20.897-03:00  INFO 12460 --- [cnpj-batch] [RMI TCP Connection(30)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T14:23:20.904-03:00  INFO 12460 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-24T14:23:20.909-03:00  INFO 12460 --- [cnpj-batch] [RMI TCP Connection(30)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:23:20.911-03:00  INFO 12460 --- [cnpj-batch] [RMI TCP Connection(30)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T14:23:20.915-03:00  INFO 12460 --- [cnpj-batch] [RMI TCP Connection(30)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T14:23:55.167-03:00  INFO 21556 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 21556 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T14:23:55.169-03:00  INFO 21556 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T14:23:55.506-03:00  INFO 21556 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T14:23:55.551-03:00  INFO 21556 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 38 ms. Found 5 JPA repository interfaces.
2025-11-24T14:23:56.050-03:00  INFO 21556 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T14:23:56.061-03:00  INFO 21556 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T14:23:56.062-03:00  INFO 21556 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T14:23:56.110-03:00  INFO 21556 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T14:23:56.111-03:00  INFO 21556 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 910 ms
2025-11-24T14:23:56.279-03:00  INFO 21556 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T14:23:56.472-03:00  INFO 21556 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@250967f1
2025-11-24T14:23:56.474-03:00  INFO 21556 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T14:23:56.501-03:00  INFO 21556 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T14:23:56.622-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.092s)
2025-11-24T14:23:56.690-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 1
2025-11-24T14:23:56.705-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "2 - create final tables"
2025-11-24T14:23:56.846-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "3 - create indexes constraints"
2025-11-24T14:23:56.888-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "4 - batch process control"
2025-11-24T14:23:56.894-03:00  WARN 21556 --- [cnpj-batch] [main] o.f.c.i.s.DefaultSqlScriptExecutor       : DB: relation "controle_processos" already exists, skipping (SQL State: 42P07 - Error Code: 0)
2025-11-24T14:23:56.912-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "5 - create final tables cadastro"
2025-11-24T14:23:56.993-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T14:23:57.030-03:00  INFO 21556 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Successfully applied 5 migrations to schema "cnpj", now at version v6 (execution time 00:00.192s)
2025-11-24T14:23:57.151-03:00  INFO 21556 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T14:23:57.221-03:00  INFO 21556 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T14:23:57.258-03:00  INFO 21556 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T14:23:57.516-03:00  INFO 21556 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T14:23:57.600-03:00  INFO 21556 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T14:23:58.410-03:00  INFO 21556 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T14:23:58.412-03:00  INFO 21556 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:23:59.087-03:00  INFO 21556 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T14:23:59.093-03:00  INFO 21556 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 4.254 seconds (process running for 4.809)
2025-11-24T14:29:48.927-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T14:29:48.928-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T14:29:48.929-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-11-24T14:29:49.023-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764005388988, type=class java.lang.Long, identifying=true}'}]
2025-11-24T14:29:49.061-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T14:29:49.080-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T14:29:49.086-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=5000000 | threads=4
2025-11-24T14:29:49.088-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_cnaes
2025-11-24T14:29:49.088-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T14:29:49.088-03:00  INFO 21556 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T14:29:49.091-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=5000000 | threads=4
2025-11-24T14:29:49.092-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_motivos
2025-11-24T14:29:49.092-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T14:29:49.092-03:00  INFO 21556 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T14:29:49.096-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=5000000 | threads=4
2025-11-24T14:29:49.097-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_municipios
2025-11-24T14:29:49.097-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T14:29:49.097-03:00  INFO 21556 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T14:29:49.100-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=5000000 | threads=4
2025-11-24T14:29:49.101-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_naturezas
2025-11-24T14:29:49.101-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T14:29:49.101-03:00  INFO 21556 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T14:29:49.104-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=5000000 | threads=4
2025-11-24T14:29:49.104-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_paises
2025-11-24T14:29:49.104-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T14:29:49.104-03:00  INFO 21556 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T14:29:49.107-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=5000000 | threads=4
2025-11-24T14:29:49.108-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_qualificacoes
2025-11-24T14:29:49.108-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T14:29:49.108-03:00  INFO 21556 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T14:29:49.193-03:00  INFO 21556 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T14:29:49.193-03:00  INFO 21556 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T14:29:49.209-03:00  INFO 21556 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T14:29:49.209-03:00  INFO 21556 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T14:29:49.213-03:00  INFO 21556 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T14:29:49.230-03:00  INFO 21556 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T14:29:49.290-03:00  INFO 21556 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T14:29:49.290-03:00  INFO 21556 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_naturezas_block bloco 0 - 90
2025-11-24T14:29:49.290-03:00  INFO 21556 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T14:29:49.319-03:00  INFO 21556 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 227 ms (0 segundos)
2025-11-24T14:29:49.324-03:00  INFO 21556 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Finalizado bloco proc_merge_naturezas intervalo [0 - 90] em 223 ms (0 segundos)
2025-11-24T14:29:49.324-03:00 ERROR 21556 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_qualificacoes_block bloco 0 - 67: PreparedStatementCallback; bad SQL grammar [CALL cnpj.proc_merge_qualificacoes_block(?, ?)]
2025-11-24T14:29:49.324-03:00  INFO 21556 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_cnaes_block bloco 0 - 1358
2025-11-24T14:29:49.324-03:00  INFO 21556 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 220 ms (0 segundos)
2025-11-24T14:29:49.328-03:00  INFO 21556 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T14:29:49.331-03:00  INFO 21556 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Finalizado bloco proc_merge_cnaes intervalo [0 - 1358] em 243 ms (0 segundos)
2025-11-24T14:29:49.346-03:00  INFO 21556 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 249 ms (0 segundos)
2025-11-24T14:30:39.619-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=5000000 | threads=4
2025-11-24T14:30:39.620-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 4999999]
2025-11-24T14:30:39.620-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_empresa
2025-11-24T14:30:39.620-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 9999999]
2025-11-24T14:30:39.620-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 14999999]
2025-11-24T14:30:39.620-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [15000000 - 19999999]
2025-11-24T14:30:39.631-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 50s570ms
2025-11-24T14:30:39.632-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 15000000 - 19999999
2025-11-24T14:30:39.632-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 14999999
2025-11-24T14:30:39.632-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 9999999
2025-11-24T14:30:39.632-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 4999999
2025-11-24T14:30:39.665-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [cleanupStep]
2025-11-24T14:30:39.686-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [cleanupStep] executed in 21ms
2025-11-24T14:30:39.724-03:00  INFO 21556 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764005388988, type=class java.lang.Long, identifying=true}'}] and the following status: [COMPLETED] in 50s676ms
2025-11-24T14:30:40.018-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 15000000 - 19999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(48b01055b03c875d6bcee1e04f5fa3b6) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.021-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 24999999]
2025-11-24T14:30:40.059-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 20000000 - 24999999
2025-11-24T14:30:40.162-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 0 - 4999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.162-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 5000000 - 9999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(6fb808ae53be0a6670292388eeb07301) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.164-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [25000000 - 29999999]
2025-11-24T14:30:40.165-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [30000000 - 34999999]
2025-11-24T14:30:40.194-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 25000000 - 29999999
2025-11-24T14:30:40.207-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 30000000 - 34999999
2025-11-24T14:30:40.277-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 10000000 - 14999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(8bcb30fcfb876cb00470f0d6544549ed) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.279-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [35000000 - 39999999]
2025-11-24T14:30:40.296-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 35000000 - 39999999
2025-11-24T14:30:40.624-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 30000000 - 34999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(d24f6273cbfa4552bee33681918dc66a) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.626-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [40000000 - 44999999]
2025-11-24T14:30:40.643-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 40000000 - 44999999
2025-11-24T14:30:40.858-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 35000000 - 39999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(9b436453f97a3154337059ef946e83d9) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.859-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [45000000 - 49999999]
2025-11-24T14:30:40.882-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 45000000 - 49999999
2025-11-24T14:30:40.930-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 40000000 - 44999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(c59b7595740a504c0df0cb7e35167847) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:40.932-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [50000000 - 54999999]
2025-11-24T14:30:40.946-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 50000000 - 54999999
2025-11-24T14:30:41.298-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 50000000 - 54999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(03533e7fb352eaaefa481ef857aa9b3d) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:41.300-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [55000000 - 59999999]
2025-11-24T14:30:41.311-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 55000000 - 59999999
2025-11-24T14:30:41.666-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 45000000 - 49999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(5a31ebcb34c4b2eae0ce634eb7177551) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:41.668-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [60000000 - 64999999]
2025-11-24T14:30:41.678-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 60000000 - 64999999
2025-11-24T14:30:41.721-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 55000000 - 59999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(964e41f06006c1a5969fd51de7e35729) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:41.723-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [65000000 - 65277299]
2025-11-24T14:30:41.739-03:00  INFO 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 65000000 - 65277299
2025-11-24T14:30:41.908-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 60000000 - 64999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(60ba5390ff0d9cff342e2c2c0752ec8b) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:41.963-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 65000000 - 65277299: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:42.019-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 20000000 - 24999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(b6ef2ccdc0eb3943230f0e79b6a8ae2d) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:30:42.029-03:00 ERROR 21556 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 25000000 - 29999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(64c3b58b90343e2dcdd214298b487688) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:46:44.053-03:00  INFO 21556 --- [cnpj-batch] [RMI TCP Connection(33)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T14:46:44.056-03:00  INFO 21556 --- [cnpj-batch] [RMI TCP Connection(33)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T14:46:44.065-03:00  INFO 21556 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-24T14:46:44.074-03:00  INFO 21556 --- [cnpj-batch] [RMI TCP Connection(33)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:46:44.076-03:00  INFO 21556 --- [cnpj-batch] [RMI TCP Connection(33)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T14:46:44.082-03:00  INFO 21556 --- [cnpj-batch] [RMI TCP Connection(33)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T14:46:46.809-03:00  INFO 8024 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 8024 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T14:46:46.811-03:00  INFO 8024 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T14:46:47.158-03:00  INFO 8024 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T14:46:47.206-03:00  INFO 8024 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 39 ms. Found 5 JPA repository interfaces.
2025-11-24T14:46:47.736-03:00  INFO 8024 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T14:46:47.746-03:00  INFO 8024 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T14:46:47.746-03:00  INFO 8024 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T14:46:47.796-03:00  INFO 8024 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T14:46:47.796-03:00  INFO 8024 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 949 ms
2025-11-24T14:46:47.995-03:00  INFO 8024 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T14:46:48.185-03:00  INFO 8024 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@661e1399
2025-11-24T14:46:48.186-03:00  INFO 8024 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T14:46:48.211-03:00  INFO 8024 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T14:46:48.285-03:00  INFO 8024 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.043s)
2025-11-24T14:46:48.410-03:00  INFO 8024 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T14:46:48.433-03:00  INFO 8024 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T14:46:48.495-03:00  INFO 8024 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema "cnpj", now at version v6 (execution time 00:00.023s)
2025-11-24T14:46:48.594-03:00  INFO 8024 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T14:46:48.646-03:00  INFO 8024 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T14:46:48.674-03:00  INFO 8024 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T14:46:48.909-03:00  INFO 8024 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T14:46:48.983-03:00  INFO 8024 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T14:46:49.744-03:00  INFO 8024 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T14:46:49.746-03:00  INFO 8024 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:46:50.379-03:00  INFO 8024 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T14:46:50.386-03:00  INFO 8024 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 3.933 seconds (process running for 4.521)
2025-11-24T14:47:01.502-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T14:47:01.502-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T14:47:01.503-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-11-24T14:47:01.611-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764006421566, type=class java.lang.Long, identifying=true}'}]
2025-11-24T14:47:01.649-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T14:47:01.666-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T14:47:01.672-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=5000000 | threads=4
2025-11-24T14:47:01.675-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_cnaes
2025-11-24T14:47:01.675-03:00  INFO 8024 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T14:47:01.675-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T14:47:01.678-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=5000000 | threads=4
2025-11-24T14:47:01.679-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_motivos
2025-11-24T14:47:01.679-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T14:47:01.679-03:00  INFO 8024 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T14:47:01.683-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=5000000 | threads=4
2025-11-24T14:47:01.683-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_municipios
2025-11-24T14:47:01.684-03:00  INFO 8024 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T14:47:01.684-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T14:47:01.687-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=5000000 | threads=4
2025-11-24T14:47:01.687-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_naturezas
2025-11-24T14:47:01.687-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T14:47:01.687-03:00  INFO 8024 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T14:47:01.691-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=5000000 | threads=4
2025-11-24T14:47:01.692-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_paises
2025-11-24T14:47:01.692-03:00  INFO 8024 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T14:47:01.692-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T14:47:01.695-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=5000000 | threads=4
2025-11-24T14:47:01.696-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_qualificacoes
2025-11-24T14:47:01.696-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T14:47:01.696-03:00  INFO 8024 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T14:47:01.781-03:00  INFO 8024 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T14:47:01.781-03:00  INFO 8024 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T14:47:01.781-03:00  INFO 8024 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T14:47:01.797-03:00  INFO 8024 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T14:47:01.811-03:00  INFO 8024 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T14:47:01.811-03:00  INFO 8024 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T14:47:01.850-03:00  INFO 8024 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T14:47:01.852-03:00  INFO 8024 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 173 ms (0 segundos)
2025-11-24T14:47:01.852-03:00  INFO 8024 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_cnaes_block bloco 0 - 1358
2025-11-24T14:47:01.852-03:00  INFO 8024 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_naturezas_block bloco 0 - 90
2025-11-24T14:47:01.854-03:00  INFO 8024 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Finalizado bloco proc_merge_naturezas intervalo [0 - 90] em 167 ms (0 segundos)
2025-11-24T14:47:01.854-03:00  INFO 8024 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Finalizado bloco proc_merge_cnaes intervalo [0 - 1358] em 179 ms (0 segundos)
2025-11-24T14:47:01.859-03:00  INFO 8024 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T14:47:01.860-03:00  INFO 8024 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 176 ms (0 segundos)
2025-11-24T14:47:01.863-03:00  INFO 8024 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_qualificacoes_block bloco 0 - 67
2025-11-24T14:47:01.864-03:00  INFO 8024 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T14:47:01.866-03:00  INFO 8024 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 174 ms (0 segundos)
2025-11-24T14:47:01.877-03:00  INFO 8024 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Finalizado bloco proc_merge_qualificacoes intervalo [0 - 67] em 181 ms (0 segundos)
2025-11-24T14:47:51.250-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=5000000 | threads=4
2025-11-24T14:47:51.251-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 4999999]
2025-11-24T14:47:51.251-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_empresa
2025-11-24T14:47:51.251-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [15000000 - 19999999]
2025-11-24T14:47:51.251-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 9999999]
2025-11-24T14:47:51.251-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 14999999]
2025-11-24T14:47:51.259-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 49s608ms
2025-11-24T14:47:51.260-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 14999999
2025-11-24T14:47:51.260-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 15000000 - 19999999
2025-11-24T14:47:51.282-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 9999999
2025-11-24T14:47:51.282-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 4999999
2025-11-24T14:47:51.308-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [cleanupStep]
2025-11-24T14:47:51.326-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [cleanupStep] executed in 18ms
2025-11-24T14:47:51.351-03:00  INFO 8024 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764006421566, type=class java.lang.Long, identifying=true}'}] and the following status: [COMPLETED] in 49s722ms
2025-11-24T14:47:51.712-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 15000000 - 19999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(48b01055b03c875d6bcee1e04f5fa3b6) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:51.716-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 24999999]
2025-11-24T14:47:51.725-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 20000000 - 24999999
2025-11-24T14:47:53.565-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 20000000 - 24999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(b6ef2ccdc0eb3943230f0e79b6a8ae2d) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:53.567-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [25000000 - 29999999]
2025-11-24T14:47:53.574-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 25000000 - 29999999
2025-11-24T14:47:53.788-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 25000000 - 29999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(64c3b58b90343e2dcdd214298b487688) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:53.790-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [30000000 - 34999999]
2025-11-24T14:47:53.797-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 30000000 - 34999999
2025-11-24T14:47:54.198-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 0 - 4999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:54.200-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [35000000 - 39999999]
2025-11-24T14:47:54.214-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 35000000 - 39999999
2025-11-24T14:47:54.374-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 30000000 - 34999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(d24f6273cbfa4552bee33681918dc66a) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:54.377-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [40000000 - 44999999]
2025-11-24T14:47:54.386-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 40000000 - 44999999
2025-11-24T14:47:54.680-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 40000000 - 44999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(c59b7595740a504c0df0cb7e35167847) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:54.682-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [45000000 - 49999999]
2025-11-24T14:47:54.692-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 35000000 - 39999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(9b436453f97a3154337059ef946e83d9) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:54.693-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 45000000 - 49999999
2025-11-24T14:47:54.695-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [50000000 - 54999999]
2025-11-24T14:47:54.703-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 50000000 - 54999999
2025-11-24T14:47:54.966-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 50000000 - 54999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(03533e7fb352eaaefa481ef857aa9b3d) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:54.968-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [55000000 - 59999999]
2025-11-24T14:47:54.980-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 55000000 - 59999999
2025-11-24T14:47:55.006-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 5000000 - 9999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(6fb808ae53be0a6670292388eeb07301) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:55.008-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [60000000 - 64999999]
2025-11-24T14:47:55.022-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 60000000 - 64999999
2025-11-24T14:47:55.181-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 45000000 - 49999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(5a31ebcb34c4b2eae0ce634eb7177551) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:55.184-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [65000000 - 65277299]
2025-11-24T14:47:55.197-03:00  INFO 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 65000000 - 65277299
2025-11-24T14:47:55.267-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 60000000 - 64999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(60ba5390ff0d9cff342e2c2c0752ec8b) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:55.318-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 55000000 - 59999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(964e41f06006c1a5969fd51de7e35729) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:47:55.407-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 65000000 - 65277299: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:48:00.375-03:00 ERROR 8024 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 10000000 - 14999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(8bcb30fcfb876cb00470f0d6544549ed) already exists.
  Onde: SQL statement "INSERT INTO cnpj.empresa (
        cnpj_basico,
        razao_social,
        natureza_juridica,
        qualificacao_responsavel,
        capital_social,
        porte,
        ente_federativo_responsavel,
        hash
    )
    SELECT
	    trim(coalesce(s.cnpj_basico,'')),
	    trim(coalesce(s.razao_social,'')),
	    trim(coalesce(s.natureza_juridica,'')),
	    trim(coalesce(s.qualificacao_responsavel,'')),
	    trim(coalesce(s.capital_social,'')),
	    trim(coalesce(s.porte,'')),
	    trim(coalesce(s.ente_federativo_responsavel,'')),
        md5(
	        trim(coalesce(s.razao_social,'')) ||
	        trim(coalesce(s.natureza_juridica,'')) ||
	        trim(coalesce(s.qualificacao_responsavel,'')) ||
	        trim(coalesce(s.capital_social,'')) ||
	        trim(coalesce(s.porte,'')) ||
	        trim(coalesce(s.ente_federativo_responsavel,''))
        )
    FROM cnpj.stage_empresa s
    LEFT JOIN cnpj.empresa f ON f.cnpj_basico = s.cnpj_basico
    WHERE f.cnpj_basico IS NULL
      AND s.id BETWEEN p_inicio AND p_fim"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 4 at SQL statement
2025-11-24T14:50:02.892-03:00  INFO 8024 --- [cnpj-batch] [RMI TCP Connection(13)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T14:50:02.894-03:00  INFO 8024 --- [cnpj-batch] [RMI TCP Connection(13)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T14:50:02.901-03:00  INFO 8024 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-24T14:50:02.906-03:00  INFO 8024 --- [cnpj-batch] [RMI TCP Connection(13)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:50:02.907-03:00  INFO 8024 --- [cnpj-batch] [RMI TCP Connection(13)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T14:50:02.910-03:00  INFO 8024 --- [cnpj-batch] [RMI TCP Connection(13)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T14:55:40.455-03:00  INFO 19140 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 19140 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T14:55:40.456-03:00  INFO 19140 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T14:55:40.792-03:00  INFO 19140 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T14:55:40.836-03:00  INFO 19140 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 36 ms. Found 5 JPA repository interfaces.
2025-11-24T14:55:41.335-03:00  INFO 19140 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T14:55:41.345-03:00  INFO 19140 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T14:55:41.345-03:00  INFO 19140 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T14:55:41.391-03:00  INFO 19140 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T14:55:41.392-03:00  INFO 19140 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 904 ms
2025-11-24T14:55:41.551-03:00  INFO 19140 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T14:55:41.792-03:00  INFO 19140 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@61b838f2
2025-11-24T14:55:41.794-03:00  INFO 19140 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T14:55:41.820-03:00  INFO 19140 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T14:55:41.898-03:00  WARN 19140 --- [cnpj-batch] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Validate failed: Migrations have failed validation
Migration checksum mismatch for migration version 6
-> Applied to database : 919357104
-> Resolved locally    : 127190884
Either revert the changes to the migration, or run repair to update the schema history.
Need more flexibility with validation rules? Learn more: https://rd.gt/3AbJUZE
2025-11-24T14:55:41.899-03:00  INFO 19140 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T14:55:41.900-03:00  INFO 19140 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T14:55:41.902-03:00  INFO 19140 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-11-24T14:55:41.911-03:00  INFO 19140 --- [cnpj-batch] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-11-24T14:55:41.924-03:00 ERROR 19140 --- [cnpj-batch] [main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Failed to initialize dependency 'flyway' of LoadTimeWeaverAware bean 'entityManagerFactory': Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Validate failed: Migrations have failed validation
Migration checksum mismatch for migration version 6
-> Applied to database : 919357104
-> Resolved locally    : 127190884
Either revert the changes to the migration, or run repair to update the schema history.
Need more flexibility with validation rules? Learn more: https://rd.gt/3AbJUZE
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:328) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:973) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.12.jar:6.2.12]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.5.7.jar:3.5.7]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.5.7.jar:3.5.7]
	at br.com.simplificarest.cnpjbatch.CnpjBatchApplication.main(CnpjBatchApplication.java:12) ~[classes/:na]
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [br/com/simplificarest/cnpjbatch/batch/config/FlywayConfig.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Validate failed: Migrations have failed validation
Migration checksum mismatch for migration version 6
-> Applied to database : 919357104
-> Resolved locally    : 127190884
Either revert the changes to the migration, or run repair to update the schema history.
Need more flexibility with validation rules? Learn more: https://rd.gt/3AbJUZE
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315) ~[spring-beans-6.2.12.jar:6.2.12]
	... 10 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Validate failed: Migrations have failed validation
Migration checksum mismatch for migration version 6
-> Applied to database : 919357104
-> Resolved locally    : 127190884
Either revert the changes to the migration, or run repair to update the schema history.
Need more flexibility with validation rules? Learn more: https://rd.gt/3AbJUZE
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:200) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169) ~[spring-beans-6.2.12.jar:6.2.12]
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.12.jar:6.2.12]
	... 20 common frames omitted
Caused by: org.flywaydb.core.api.exception.FlywayValidateException: Validate failed: Migrations have failed validation
Migration checksum mismatch for migration version 6
-> Applied to database : 919357104
-> Resolved locally    : 127190884
Either revert the changes to the migration, or run repair to update the schema history.
Need more flexibility with validation rules? Learn more: https://rd.gt/3AbJUZE
	at org.flywaydb.core.Flyway.lambda$migrate$1(Flyway.java:201) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:210) ~[flyway-core-11.7.2.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:188) ~[flyway-core-11.7.2.jar:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig.flyway(FlywayConfig.java:21) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.CGLIB$flyway$0(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>) ~[classes/:na]
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.12.jar:6.2.12]
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400) ~[spring-context-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.config.FlywayConfig$$SpringCGLIB$$0.flyway(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172) ~[spring-beans-6.2.12.jar:6.2.12]
	... 23 common frames omitted

2025-11-24T14:55:55.353-03:00  INFO 18604 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 18604 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T14:55:55.355-03:00  INFO 18604 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T14:55:55.682-03:00  INFO 18604 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T14:55:55.724-03:00  INFO 18604 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 35 ms. Found 5 JPA repository interfaces.
2025-11-24T14:55:56.209-03:00  INFO 18604 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T14:55:56.220-03:00  INFO 18604 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T14:55:56.220-03:00  INFO 18604 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T14:55:56.266-03:00  INFO 18604 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T14:55:56.266-03:00  INFO 18604 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 879 ms
2025-11-24T14:55:56.445-03:00  INFO 18604 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T14:55:56.636-03:00  INFO 18604 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4bce62b
2025-11-24T14:55:56.637-03:00  INFO 18604 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T14:55:56.665-03:00  INFO 18604 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T14:55:56.723-03:00  INFO 18604 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.031s)
2025-11-24T14:55:56.835-03:00  INFO 18604 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T14:55:56.858-03:00  INFO 18604 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T14:55:56.927-03:00  INFO 18604 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema "cnpj", now at version v6 (execution time 00:00.024s)
2025-11-24T14:55:57.036-03:00  INFO 18604 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T14:55:57.083-03:00  INFO 18604 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T14:55:57.110-03:00  INFO 18604 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T14:55:57.337-03:00  INFO 18604 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T14:55:57.403-03:00  INFO 18604 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T14:55:58.141-03:00  INFO 18604 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T14:55:58.144-03:00  INFO 18604 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T14:55:58.801-03:00  INFO 18604 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T14:55:58.807-03:00  INFO 18604 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 3.772 seconds (process running for 4.368)
2025-11-24T14:56:21.775-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T14:56:21.776-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T14:56:21.777-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-11-24T14:56:21.880-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764006981841, type=class java.lang.Long, identifying=true}'}]
2025-11-24T14:56:21.920-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T14:56:21.939-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T14:56:21.945-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=5000000 | threads=4
2025-11-24T14:56:21.946-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_cnaes
2025-11-24T14:56:21.946-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T14:56:21.946-03:00  INFO 18604 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T14:56:21.949-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=5000000 | threads=4
2025-11-24T14:56:21.950-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_motivos
2025-11-24T14:56:21.950-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T14:56:21.950-03:00  INFO 18604 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T14:56:21.954-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=5000000 | threads=4
2025-11-24T14:56:21.954-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_municipios
2025-11-24T14:56:21.954-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T14:56:21.954-03:00  INFO 18604 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T14:56:21.957-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=5000000 | threads=4
2025-11-24T14:56:21.959-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_naturezas
2025-11-24T14:56:21.959-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T14:56:21.959-03:00  INFO 18604 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T14:56:21.962-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=5000000 | threads=4
2025-11-24T14:56:21.963-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_paises
2025-11-24T14:56:21.963-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T14:56:21.963-03:00  INFO 18604 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T14:56:21.967-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=5000000 | threads=4
2025-11-24T14:56:21.967-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_qualificacoes
2025-11-24T14:56:21.967-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T14:56:21.967-03:00  INFO 18604 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T14:56:22.061-03:00  INFO 18604 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T14:56:22.061-03:00  INFO 18604 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T14:56:22.079-03:00  INFO 18604 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T14:56:22.079-03:00  INFO 18604 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T14:56:22.080-03:00  INFO 18604 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T14:56:22.103-03:00  INFO 18604 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T14:56:22.139-03:00  INFO 18604 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_naturezas_block bloco 0 - 90
2025-11-24T14:56:22.140-03:00  INFO 18604 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Finalizado bloco proc_merge_naturezas intervalo [0 - 90] em 181 ms (0 segundos)
2025-11-24T14:56:22.141-03:00  INFO 18604 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T14:56:22.141-03:00  INFO 18604 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T14:56:22.142-03:00  INFO 18604 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 179 ms (0 segundos)
2025-11-24T14:56:22.142-03:00  INFO 18604 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 192 ms (0 segundos)
2025-11-24T14:56:22.147-03:00  INFO 18604 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_cnaes_block bloco 0 - 1358
2025-11-24T14:56:22.149-03:00  INFO 18604 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Finalizado bloco proc_merge_cnaes intervalo [0 - 1358] em 203 ms (0 segundos)
2025-11-24T14:56:22.150-03:00  INFO 18604 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_qualificacoes_block bloco 0 - 67
2025-11-24T14:56:22.151-03:00  INFO 18604 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Finalizado bloco proc_merge_qualificacoes intervalo [0 - 67] em 184 ms (0 segundos)
2025-11-24T14:56:22.163-03:00  INFO 18604 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T14:56:22.165-03:00  INFO 18604 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 211 ms (0 segundos)
2025-11-24T14:57:11.443-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=5000000 | threads=4
2025-11-24T14:57:11.444-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : ThreadPool encerrado para procedure proc_merge_empresa
2025-11-24T14:57:11.444-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 4999999]
2025-11-24T14:57:11.444-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 9999999]
2025-11-24T14:57:11.444-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 14999999]
2025-11-24T14:57:11.444-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [15000000 - 19999999]
2025-11-24T14:57:11.454-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 49s533ms
2025-11-24T14:57:11.469-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 14999999
2025-11-24T14:57:11.469-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 9999999
2025-11-24T14:57:11.469-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 15000000 - 19999999
2025-11-24T14:57:11.469-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 4999999
2025-11-24T14:57:11.501-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [cleanupStep]
2025-11-24T14:57:11.521-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [cleanupStep] executed in 19ms
2025-11-24T14:57:11.547-03:00  INFO 18604 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764006981841, type=class java.lang.Long, identifying=true}'}] and the following status: [COMPLETED] in 49s647ms
2025-11-24T15:03:48.044-03:00  INFO 18604 --- [cnpj-batch] [RMI TCP Connection(17)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T15:03:48.046-03:00  INFO 18604 --- [cnpj-batch] [RMI TCP Connection(17)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T15:03:48.055-03:00  INFO 18604 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-24T15:03:48.059-03:00  INFO 18604 --- [cnpj-batch] [RMI TCP Connection(17)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T15:03:48.061-03:00  INFO 18604 --- [cnpj-batch] [RMI TCP Connection(17)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T15:03:48.064-03:00  INFO 18604 --- [cnpj-batch] [RMI TCP Connection(17)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T15:03:48.072-03:00  WARN 18604 --- [cnpj-batch] [pool-8-thread-2] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@60ff6a0c marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T15:03:48.072-03:00  WARN 18604 --- [cnpj-batch] [pool-8-thread-4] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@104693cc marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T15:03:48.072-03:00  WARN 18604 --- [cnpj-batch] [pool-8-thread-3] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@441ffb59 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T15:03:48.072-03:00  WARN 18604 --- [cnpj-batch] [pool-8-thread-1] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@5980a845 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T15:03:48.086-03:00 ERROR 18604 --- [cnpj-batch] [pool-8-thread-4] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T15:03:48.086-03:00 ERROR 18604 --- [cnpj-batch] [pool-8-thread-1] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T15:03:48.086-03:00 ERROR 18604 --- [cnpj-batch] [pool-8-thread-2] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T15:03:48.086-03:00 ERROR 18604 --- [cnpj-batch] [pool-8-thread-3] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:84) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T15:03:48.088-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 24999999]
2025-11-24T15:03:48.088-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [30000000 - 34999999]
2025-11-24T15:03:48.088-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [25000000 - 29999999]
2025-11-24T15:03:48.088-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [35000000 - 39999999]
2025-11-24T15:03:48.088-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [45000000 - 49999999]
2025-11-24T15:03:48.089-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [50000000 - 54999999]
2025-11-24T15:03:48.088-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-4] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-4] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [40000000 - 44999999]
2025-11-24T15:03:48.089-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [55000000 - 59999999]
2025-11-24T15:03:48.089-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-3] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-3] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [60000000 - 64999999]
2025-11-24T15:03:48.089-03:00  INFO 18604 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [65000000 - 65277299]
2025-11-24T15:41:55.947-03:00  INFO 22356 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 22356 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T15:41:55.949-03:00  INFO 22356 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T15:41:56.309-03:00  INFO 22356 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T15:41:56.353-03:00  INFO 22356 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 36 ms. Found 5 JPA repository interfaces.
2025-11-24T15:41:56.930-03:00  INFO 22356 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T15:41:56.946-03:00  INFO 22356 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T15:41:56.947-03:00  INFO 22356 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T15:41:57.004-03:00  INFO 22356 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T15:41:57.004-03:00  INFO 22356 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1023 ms
2025-11-24T15:41:57.175-03:00  INFO 22356 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T15:41:57.367-03:00  INFO 22356 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@25c1f5ee
2025-11-24T15:41:57.368-03:00  INFO 22356 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T15:41:57.396-03:00  INFO 22356 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T15:41:57.495-03:00  INFO 22356 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.038s)
2025-11-24T15:41:57.590-03:00  INFO 22356 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T15:41:57.618-03:00  INFO 22356 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T15:41:57.696-03:00  INFO 22356 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema "cnpj", now at version v6 (execution time 00:00.038s)
2025-11-24T15:41:57.828-03:00  INFO 22356 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T15:41:57.896-03:00  INFO 22356 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T15:41:57.943-03:00  INFO 22356 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T15:41:58.190-03:00  INFO 22356 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T15:41:58.281-03:00  INFO 22356 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T15:41:59.131-03:00  INFO 22356 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T15:41:59.134-03:00  INFO 22356 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T15:41:59.835-03:00  INFO 22356 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T15:41:59.841-03:00  INFO 22356 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 4.221 seconds (process running for 4.763)
2025-11-24T15:56:33.849-03:00  INFO 22356 --- [cnpj-batch] [RMI TCP Connection(24)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T15:56:33.851-03:00  INFO 22356 --- [cnpj-batch] [RMI TCP Connection(24)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T15:56:33.858-03:00  INFO 22356 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-11-24T15:56:33.861-03:00  INFO 22356 --- [cnpj-batch] [RMI TCP Connection(24)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T15:56:33.863-03:00  INFO 22356 --- [cnpj-batch] [RMI TCP Connection(24)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T15:56:33.867-03:00  INFO 22356 --- [cnpj-batch] [RMI TCP Connection(24)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T15:56:35.925-03:00  INFO 12272 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 12272 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T15:56:35.927-03:00  INFO 12272 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T15:56:36.279-03:00  INFO 12272 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T15:56:36.324-03:00  INFO 12272 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 37 ms. Found 5 JPA repository interfaces.
2025-11-24T15:56:36.834-03:00  INFO 12272 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T15:56:36.847-03:00  INFO 12272 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T15:56:36.847-03:00  INFO 12272 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T15:56:36.899-03:00  INFO 12272 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T15:56:36.900-03:00  INFO 12272 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 939 ms
2025-11-24T15:56:37.085-03:00  INFO 12272 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T15:56:37.287-03:00  INFO 12272 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1216eb3f
2025-11-24T15:56:37.288-03:00  INFO 12272 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T15:56:37.319-03:00  INFO 12272 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T15:56:37.380-03:00  INFO 12272 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.033s)
2025-11-24T15:56:37.492-03:00  INFO 12272 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 6
2025-11-24T15:56:37.495-03:00  INFO 12272 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Schema "cnpj" is up to date. No migration necessary.
2025-11-24T15:56:37.599-03:00  INFO 12272 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T15:56:37.640-03:00  INFO 12272 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T15:56:37.666-03:00  INFO 12272 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T15:56:37.885-03:00  INFO 12272 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T15:56:37.949-03:00  INFO 12272 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T15:56:38.716-03:00  INFO 12272 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T15:56:38.719-03:00  INFO 12272 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T15:56:39.352-03:00  INFO 12272 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T15:56:39.360-03:00  INFO 12272 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 3.768 seconds (process running for 4.356)
2025-11-24T16:01:17.469-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T16:01:17.469-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T16:01:17.470-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-11-24T16:01:17.611-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764010877557, type=class java.lang.Long, identifying=true}'}]
2025-11-24T16:01:17.660-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T16:01:17.678-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T16:01:17.691-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=1000000 | threads=2
2025-11-24T16:01:17.693-03:00  INFO 12272 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T16:01:17.789-03:00  INFO 12272 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T16:01:17.860-03:00  INFO 12272 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_cnaes_block bloco 0 - 1358
2025-11-24T16:01:17.871-03:00  INFO 12272 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Finalizado bloco proc_merge_cnaes intervalo [0 - 1358] em 178 ms (0 segundos)
2025-11-24T16:01:17.872-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_cnaes
2025-11-24T16:01:17.872-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T16:01:17.877-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=1000000 | threads=2
2025-11-24T16:01:17.878-03:00  INFO 12272 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T16:01:17.885-03:00  INFO 12272 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T16:01:17.900-03:00  INFO 12272 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T16:01:17.903-03:00  INFO 12272 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 26 ms (0 segundos)
2025-11-24T16:01:17.903-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_motivos
2025-11-24T16:01:17.903-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T16:01:17.914-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=1000000 | threads=2
2025-11-24T16:01:17.915-03:00  INFO 12272 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T16:01:17.923-03:00  INFO 12272 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T16:01:18.013-03:00  INFO 12272 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T16:01:18.017-03:00  INFO 12272 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 102 ms (0 segundos)
2025-11-24T16:01:18.017-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_municipios
2025-11-24T16:01:18.017-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T16:01:18.022-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=1000000 | threads=2
2025-11-24T16:01:18.022-03:00  INFO 12272 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T16:01:18.027-03:00  INFO 12272 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T16:01:18.046-03:00  INFO 12272 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_naturezas_block bloco 0 - 90
2025-11-24T16:01:18.050-03:00  INFO 12272 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Finalizado bloco proc_merge_naturezas intervalo [0 - 90] em 28 ms (0 segundos)
2025-11-24T16:01:18.050-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_naturezas
2025-11-24T16:01:18.050-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T16:01:18.055-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=1000000 | threads=2
2025-11-24T16:01:18.055-03:00  INFO 12272 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T16:01:18.062-03:00  INFO 12272 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T16:01:18.081-03:00  INFO 12272 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T16:01:18.083-03:00  INFO 12272 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 28 ms (0 segundos)
2025-11-24T16:01:18.084-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_paises
2025-11-24T16:01:18.084-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T16:01:18.087-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=1000000 | threads=2
2025-11-24T16:01:18.088-03:00  INFO 12272 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T16:01:18.096-03:00  INFO 12272 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T16:01:18.111-03:00  INFO 12272 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_qualificacoes_block bloco 0 - 67
2025-11-24T16:01:18.113-03:00  INFO 12272 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Finalizado bloco proc_merge_qualificacoes intervalo [0 - 67] em 25 ms (0 segundos)
2025-11-24T16:01:18.114-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_qualificacoes
2025-11-24T16:01:18.114-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T16:02:08.969-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=1000000 | threads=2
2025-11-24T16:02:08.969-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 999999]
2025-11-24T16:02:08.969-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [1000000 - 1999999]
2025-11-24T16:02:08.988-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 1000000 - 1999999
2025-11-24T16:02:08.998-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 999999
2025-11-24T16:03:23.513-03:00 ERROR 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 1000000 - 1999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(b2eb2d48d9ca523afcde21dcde364257) already exists.
  Onde: SQL statement "UPDATE cnpj.empresa f
    SET
        razao_social = s.razao_social,
        natureza_juridica = s.natureza_juridica,
        qualificacao_responsavel = s.qualificacao_responsavel,
        capital_social = COALESCE(s.capital_social,''),
        porte = s.porte,
        ente_federativo_responsavel = s.ente_federativo_responsavel,
        hash = md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        ),
        atualizado_em = now()
    FROM cnpj.stage_empresa s
    WHERE f.cnpj_basico = s.cnpj_basico
      AND s.id BETWEEN p_inicio AND p_fim
      AND f.hash IS DISTINCT FROM md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        )"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 37 at SQL statement
2025-11-24T16:03:23.519-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [2000000 - 2999999]
2025-11-24T16:03:23.545-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 2000000 - 2999999
2025-11-24T16:03:47.370-03:00 ERROR 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 0 - 999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "UPDATE cnpj.empresa f
    SET
        razao_social = s.razao_social,
        natureza_juridica = s.natureza_juridica,
        qualificacao_responsavel = s.qualificacao_responsavel,
        capital_social = COALESCE(s.capital_social,''),
        porte = s.porte,
        ente_federativo_responsavel = s.ente_federativo_responsavel,
        hash = md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        ),
        atualizado_em = now()
    FROM cnpj.stage_empresa s
    WHERE f.cnpj_basico = s.cnpj_basico
      AND s.id BETWEEN p_inicio AND p_fim
      AND f.hash IS DISTINCT FROM md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        )"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 37 at SQL statement
2025-11-24T16:03:47.375-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [3000000 - 3999999]
2025-11-24T16:03:47.435-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 3000000 - 3999999
2025-11-24T16:10:35.142-03:00 ERROR 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 2000000 - 2999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(4a297c0c2ec80ef8286d91a92786bdbc) already exists.
  Onde: SQL statement "UPDATE cnpj.empresa f
    SET
        razao_social = s.razao_social,
        natureza_juridica = s.natureza_juridica,
        qualificacao_responsavel = s.qualificacao_responsavel,
        capital_social = COALESCE(s.capital_social,''),
        porte = s.porte,
        ente_federativo_responsavel = s.ente_federativo_responsavel,
        hash = md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        ),
        atualizado_em = now()
    FROM cnpj.stage_empresa s
    WHERE f.cnpj_basico = s.cnpj_basico
      AND s.id BETWEEN p_inicio AND p_fim
      AND f.hash IS DISTINCT FROM md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        )"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 37 at SQL statement
2025-11-24T16:10:35.146-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [4000000 - 4999999]
2025-11-24T16:10:35.158-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 4000000 - 4999999
2025-11-24T16:10:56.205-03:00 ERROR 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Erro ao executar proc_merge_empresa_block bloco 3000000 - 3999999: PreparedStatementCallback; SQL [CALL cnpj.proc_merge_empresa_block(?, ?)]; ERROR: duplicate key value violates unique constraint "empresa_hash_uk"
  Detalhe: Key (hash)=(e7cd3edbd6c973d5e4e28b738f48c14a) already exists.
  Onde: SQL statement "UPDATE cnpj.empresa f
    SET
        razao_social = s.razao_social,
        natureza_juridica = s.natureza_juridica,
        qualificacao_responsavel = s.qualificacao_responsavel,
        capital_social = COALESCE(s.capital_social,''),
        porte = s.porte,
        ente_federativo_responsavel = s.ente_federativo_responsavel,
        hash = md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        ),
        atualizado_em = now()
    FROM cnpj.stage_empresa s
    WHERE f.cnpj_basico = s.cnpj_basico
      AND s.id BETWEEN p_inicio AND p_fim
      AND f.hash IS DISTINCT FROM md5(
            coalesce(s.razao_social,'') ||
            coalesce(s.natureza_juridica,'') ||
            coalesce(s.qualificacao_responsavel,'') ||
            coalesce(s.capital_social,'') ||
            coalesce(s.porte,'') ||
            coalesce(s.ente_federativo_responsavel,'')
        )"
PL/pgSQL function proc_merge_empresa_block(bigint,bigint) line 37 at SQL statement
2025-11-24T16:10:56.208-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [5000000 - 5999999]
2025-11-24T16:10:56.229-03:00  INFO 12272 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 5000000 - 5999999
2025-11-24T16:11:59.904-03:00  INFO 12272 --- [cnpj-batch] [RMI TCP Connection(23)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T16:11:59.908-03:00  INFO 12272 --- [cnpj-batch] [RMI TCP Connection(23)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T16:12:29.922-03:00  INFO 12272 --- [cnpj-batch] [RMI TCP Connection(23)-127.0.0.1] o.s.c.support.DefaultLifecycleProcessor  : Shutdown phase 2147482623 ends with 1 bean still running after timeout of 30000ms: [webServerGracefulShutdown]
2025-11-24T16:12:29.924-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_empresa
2025-11-24T16:12:29.924-03:00 ERROR 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.tasklet.TaskletStep  : Thread interrupted while locking for repository update
2025-11-24T16:12:29.935-03:00  INFO 12272 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown aborted with one or more requests still active
2025-11-24T16:12:29.968-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.s.ThreadStepInterruptionPolicy   : Step interrupted through Thread API
2025-11-24T16:12:29.970-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Encountered interruption executing step mergeStep in job cnpjJob : Job interrupted status detected.
2025-11-24T16:12:29.971-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 11m12s309ms
2025-11-24T16:12:30.008-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.AbstractJob           : Encountered interruption executing job: Job interrupted by step execution
2025-11-24T16:12:30.020-03:00  INFO 12272 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764010877557, type=class java.lang.Long, identifying=true}'}] and the following status: [STOPPED] in 11m12s385ms
2025-11-24T16:12:30.046-03:00  INFO 12272 --- [cnpj-batch] [RMI TCP Connection(23)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T16:12:30.048-03:00  INFO 12272 --- [cnpj-batch] [RMI TCP Connection(23)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T16:12:30.054-03:00  INFO 12272 --- [cnpj-batch] [RMI TCP Connection(23)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T16:12:30.053-03:00  WARN 12272 --- [cnpj-batch] [pool-8-thread-2] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@35595d55 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T16:12:30.053-03:00  WARN 12272 --- [cnpj-batch] [pool-8-thread-1] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@3cbb45a3 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T16:12:30.065-03:00 ERROR 12272 --- [cnpj-batch] [pool-8-thread-1] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T16:12:30.065-03:00 ERROR 12272 --- [cnpj-batch] [pool-8-thread-2] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T16:16:44.051-03:00  INFO 17308 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 17308 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T16:16:44.053-03:00  INFO 17308 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T16:16:44.482-03:00  INFO 17308 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T16:16:44.542-03:00  INFO 17308 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 49 ms. Found 5 JPA repository interfaces.
2025-11-24T16:16:45.090-03:00  INFO 17308 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T16:16:45.104-03:00  INFO 17308 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T16:16:45.104-03:00  INFO 17308 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T16:16:45.162-03:00  INFO 17308 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T16:16:45.163-03:00  INFO 17308 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1069 ms
2025-11-24T16:16:45.347-03:00  INFO 17308 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T16:16:45.560-03:00  INFO 17308 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5ebbde60
2025-11-24T16:16:45.562-03:00  INFO 17308 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T16:16:45.596-03:00  INFO 17308 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T16:16:45.703-03:00  INFO 17308 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.054s)
2025-11-24T16:16:45.782-03:00  INFO 17308 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 5
2025-11-24T16:16:45.818-03:00  INFO 17308 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Migrating schema "cnpj" to version "6 - create merge procedures block"
2025-11-24T16:16:45.892-03:00  INFO 17308 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema "cnpj", now at version v6 (execution time 00:00.032s)
2025-11-24T16:16:46.002-03:00  INFO 17308 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T16:16:46.045-03:00  INFO 17308 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T16:16:46.082-03:00  INFO 17308 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T16:16:46.313-03:00  INFO 17308 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T16:16:46.387-03:00  INFO 17308 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T16:16:47.206-03:00  INFO 17308 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T16:16:47.209-03:00  INFO 17308 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T16:16:47.923-03:00  INFO 17308 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T16:16:47.932-03:00  INFO 17308 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 4.258 seconds (process running for 4.942)
2025-11-24T16:16:58.746-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T16:16:58.747-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T16:16:58.748-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-11-24T16:16:58.884-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764011818825, type=class java.lang.Long, identifying=true}'}]
2025-11-24T16:16:58.938-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T16:16:58.960-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T16:16:58.969-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=2000000 | threads=2
2025-11-24T16:16:58.972-03:00  INFO 17308 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T16:16:59.082-03:00  INFO 17308 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T16:16:59.154-03:00  INFO 17308 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_cnaes_block bloco 0 - 1358
2025-11-24T16:16:59.155-03:00  INFO 17308 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Finalizado bloco proc_merge_cnaes intervalo [0 - 1358] em 183 ms (0 segundos)
2025-11-24T16:16:59.156-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_cnaes
2025-11-24T16:16:59.156-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T16:16:59.161-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=2000000 | threads=2
2025-11-24T16:16:59.162-03:00  INFO 17308 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T16:16:59.171-03:00  INFO 17308 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T16:16:59.190-03:00  INFO 17308 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T16:16:59.192-03:00  INFO 17308 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 30 ms (0 segundos)
2025-11-24T16:16:59.192-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_motivos
2025-11-24T16:16:59.192-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T16:16:59.202-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=2000000 | threads=2
2025-11-24T16:16:59.203-03:00  INFO 17308 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T16:16:59.210-03:00  INFO 17308 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T16:16:59.251-03:00  INFO 17308 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T16:16:59.252-03:00  INFO 17308 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 49 ms (0 segundos)
2025-11-24T16:16:59.253-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_municipios
2025-11-24T16:16:59.253-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T16:16:59.257-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=2000000 | threads=2
2025-11-24T16:16:59.258-03:00  INFO 17308 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T16:16:59.266-03:00  INFO 17308 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T16:16:59.284-03:00  INFO 17308 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_naturezas_block bloco 0 - 90
2025-11-24T16:16:59.286-03:00  INFO 17308 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Finalizado bloco proc_merge_naturezas intervalo [0 - 90] em 28 ms (0 segundos)
2025-11-24T16:16:59.286-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_naturezas
2025-11-24T16:16:59.286-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T16:16:59.290-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=2000000 | threads=2
2025-11-24T16:16:59.291-03:00  INFO 17308 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T16:16:59.300-03:00  INFO 17308 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T16:16:59.318-03:00  INFO 17308 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T16:16:59.321-03:00  INFO 17308 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 30 ms (0 segundos)
2025-11-24T16:16:59.322-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_paises
2025-11-24T16:16:59.322-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T16:16:59.327-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=2000000 | threads=2
2025-11-24T16:16:59.328-03:00  INFO 17308 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T16:16:59.337-03:00  INFO 17308 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T16:16:59.354-03:00  INFO 17308 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_qualificacoes_block bloco 0 - 67
2025-11-24T16:16:59.355-03:00  INFO 17308 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Finalizado bloco proc_merge_qualificacoes intervalo [0 - 67] em 27 ms (0 segundos)
2025-11-24T16:16:59.356-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_qualificacoes
2025-11-24T16:16:59.356-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T16:17:48.201-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=2000000 | threads=2
2025-11-24T16:17:48.202-03:00  INFO 17308 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [2000000 - 3999999]
2025-11-24T16:17:48.202-03:00  INFO 17308 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 1999999]
2025-11-24T16:17:48.221-03:00  INFO 17308 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 2000000 - 3999999
2025-11-24T16:17:48.230-03:00  INFO 17308 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 1999999
2025-11-24T16:32:43.290-03:00  INFO 17308 --- [cnpj-batch] [RMI TCP Connection(25)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T16:32:43.293-03:00  INFO 17308 --- [cnpj-batch] [RMI TCP Connection(25)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T16:33:13.315-03:00  INFO 17308 --- [cnpj-batch] [RMI TCP Connection(25)-127.0.0.1] o.s.c.support.DefaultLifecycleProcessor  : Shutdown phase 2147482623 ends with 1 bean still running after timeout of 30000ms: [webServerGracefulShutdown]
2025-11-24T16:33:13.317-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_empresa
2025-11-24T16:33:13.317-03:00 ERROR 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.tasklet.TaskletStep  : Thread interrupted while locking for repository update
2025-11-24T16:33:13.329-03:00  INFO 17308 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown aborted with one or more requests still active
2025-11-24T16:33:13.339-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.s.ThreadStepInterruptionPolicy   : Step interrupted through Thread API
2025-11-24T16:33:13.341-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Encountered interruption executing step mergeStep in job cnpjJob : Job interrupted status detected.
2025-11-24T16:33:13.341-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 16m14s402ms
2025-11-24T16:33:13.361-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.AbstractJob           : Encountered interruption executing job: Job interrupted by step execution
2025-11-24T16:33:13.369-03:00  INFO 17308 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764011818825, type=class java.lang.Long, identifying=true}'}] and the following status: [STOPPED] in 16m14s464ms
2025-11-24T16:33:13.396-03:00  INFO 17308 --- [cnpj-batch] [RMI TCP Connection(25)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T16:33:13.399-03:00  INFO 17308 --- [cnpj-batch] [RMI TCP Connection(25)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T16:33:13.402-03:00  INFO 17308 --- [cnpj-batch] [RMI TCP Connection(25)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T16:33:13.405-03:00  WARN 17308 --- [cnpj-batch] [pool-8-thread-2] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@162dfb77 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T16:33:13.405-03:00  WARN 17308 --- [cnpj-batch] [pool-8-thread-1] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@275e932d marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T16:33:13.418-03:00 ERROR 17308 --- [cnpj-batch] [pool-8-thread-2] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T16:33:13.418-03:00 ERROR 17308 --- [cnpj-batch] [pool-8-thread-1] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T16:44:37.835-03:00  INFO 2716 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Starting CnpjBatchApplication using Java 21.0.3 with PID 2716 (D:\DEV\projeto cnpj\cnpj-batch\target\classes started by rapha in D:\DEV\projeto cnpj\cnpj-batch)
2025-11-24T16:44:37.890-03:00  INFO 2716 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : No active profile set, falling back to 1 default profile: "default"
2025-11-24T16:44:38.223-03:00  INFO 2716 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T16:44:38.270-03:00  INFO 2716 --- [cnpj-batch] [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 38 ms. Found 5 JPA repository interfaces.
2025-11-24T16:44:38.781-03:00  INFO 2716 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-11-24T16:44:38.795-03:00  INFO 2716 --- [cnpj-batch] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T16:44:38.795-03:00  INFO 2716 --- [cnpj-batch] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.48]
2025-11-24T16:44:38.845-03:00  INFO 2716 --- [cnpj-batch] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T16:44:38.846-03:00  INFO 2716 --- [cnpj-batch] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 925 ms
2025-11-24T16:44:39.014-03:00  INFO 2716 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T16:44:39.215-03:00  INFO 2716 --- [cnpj-batch] [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3f6c2763
2025-11-24T16:44:39.217-03:00  INFO 2716 --- [cnpj-batch] [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T16:44:39.243-03:00  INFO 2716 --- [cnpj-batch] [main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:postgresql://localhost:5432/cnpj (PostgreSQL 17.4)
2025-11-24T16:44:39.319-03:00  INFO 2716 --- [cnpj-batch] [main] o.f.core.internal.command.DbValidate     : Successfully validated 7 migrations (execution time 00:00.032s)
2025-11-24T16:44:39.422-03:00  INFO 2716 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Current version of schema "cnpj": 6
2025-11-24T16:44:39.425-03:00  INFO 2716 --- [cnpj-batch] [main] o.f.core.internal.command.DbMigrate      : Schema "cnpj" is up to date. No migration necessary.
2025-11-24T16:44:39.539-03:00  INFO 2716 --- [cnpj-batch] [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T16:44:39.594-03:00  INFO 2716 --- [cnpj-batch] [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.6.33.Final
2025-11-24T16:44:39.634-03:00  INFO 2716 --- [cnpj-batch] [main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T16:44:39.876-03:00  INFO 2716 --- [cnpj-batch] [main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T16:44:39.942-03:00  INFO 2716 --- [cnpj-batch] [main] org.hibernate.orm.connections.pooling    : HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.4
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-11-24T16:44:40.700-03:00  INFO 2716 --- [cnpj-batch] [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T16:44:40.702-03:00  INFO 2716 --- [cnpj-batch] [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T16:44:41.344-03:00  INFO 2716 --- [cnpj-batch] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-11-24T16:44:41.351-03:00  INFO 2716 --- [cnpj-batch] [main] b.c.s.cnpjbatch.CnpjBatchApplication     : Started CnpjBatchApplication in 3.853 seconds (process running for 4.418)
2025-11-24T16:44:46.489-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T16:44:46.489-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T16:44:46.491-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-11-24T16:44:46.613-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] launched with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764013486551, type=class java.lang.Long, identifying=true}'}]
2025-11-24T16:44:46.663-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [mergeStep]
2025-11-24T16:44:46.681-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_cnaes] para anoMes=2025-11
2025-11-24T16:44:46.694-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_cnaes de forma paralela | stage=stage_cnaes | total=1359 registros | passo=2000000 | threads=2
2025-11-24T16:44:46.696-03:00  INFO 2716 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Iniciando bloco proc_merge_cnaes (stage_cnaes) intervalo [0 - 1358]
2025-11-24T16:44:46.789-03:00  INFO 2716 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_cnaes_block com bloco 0 - 1358
2025-11-24T16:44:46.851-03:00  INFO 2716 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_cnaes_block bloco 0 - 1358
2025-11-24T16:44:46.852-03:00  INFO 2716 --- [cnpj-batch] [pool-2-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-2-thread-1] Finalizado bloco proc_merge_cnaes intervalo [0 - 1358] em 156 ms (0 segundos)
2025-11-24T16:44:46.853-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_cnaes
2025-11-24T16:44:46.853-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_motivos] para anoMes=2025-11
2025-11-24T16:44:46.858-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_motivos de forma paralela | stage=stage_motivos | total=63 registros | passo=2000000 | threads=2
2025-11-24T16:44:46.858-03:00  INFO 2716 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Iniciando bloco proc_merge_motivos (stage_motivos) intervalo [0 - 62]
2025-11-24T16:44:46.865-03:00  INFO 2716 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_motivos_block com bloco 0 - 62
2025-11-24T16:44:46.880-03:00  INFO 2716 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_motivos_block bloco 0 - 62
2025-11-24T16:44:46.881-03:00  INFO 2716 --- [cnpj-batch] [pool-3-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-3-thread-1] Finalizado bloco proc_merge_motivos intervalo [0 - 62] em 23 ms (0 segundos)
2025-11-24T16:44:46.882-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_motivos
2025-11-24T16:44:46.883-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_municipios] para anoMes=2025-11
2025-11-24T16:44:46.895-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_municipios de forma paralela | stage=stage_municipios | total=5572 registros | passo=2000000 | threads=2
2025-11-24T16:44:46.896-03:00  INFO 2716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Iniciando bloco proc_merge_municipios (stage_municipios) intervalo [0 - 5571]
2025-11-24T16:44:46.904-03:00  INFO 2716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_municipios_block com bloco 0 - 5571
2025-11-24T16:44:46.945-03:00  INFO 2716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_municipios_block bloco 0 - 5571
2025-11-24T16:44:46.947-03:00  INFO 2716 --- [cnpj-batch] [pool-4-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-4-thread-1] Finalizado bloco proc_merge_municipios intervalo [0 - 5571] em 50 ms (0 segundos)
2025-11-24T16:44:46.947-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_municipios
2025-11-24T16:44:46.947-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_naturezas] para anoMes=2025-11
2025-11-24T16:44:46.950-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_naturezas de forma paralela | stage=stage_naturezas | total=91 registros | passo=2000000 | threads=2
2025-11-24T16:44:46.951-03:00  INFO 2716 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Iniciando bloco proc_merge_naturezas (stage_naturezas) intervalo [0 - 90]
2025-11-24T16:44:46.957-03:00  INFO 2716 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_naturezas_block com bloco 0 - 90
2025-11-24T16:44:46.975-03:00  INFO 2716 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_naturezas_block bloco 0 - 90
2025-11-24T16:44:46.976-03:00  INFO 2716 --- [cnpj-batch] [pool-5-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-5-thread-1] Finalizado bloco proc_merge_naturezas intervalo [0 - 90] em 25 ms (0 segundos)
2025-11-24T16:44:46.976-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_naturezas
2025-11-24T16:44:46.976-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_paises] para anoMes=2025-11
2025-11-24T16:44:46.981-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_paises de forma paralela | stage=stage_paises | total=255 registros | passo=2000000 | threads=2
2025-11-24T16:44:46.982-03:00  INFO 2716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Iniciando bloco proc_merge_paises (stage_paises) intervalo [0 - 254]
2025-11-24T16:44:46.988-03:00  INFO 2716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_paises_block com bloco 0 - 254
2025-11-24T16:44:47.005-03:00  INFO 2716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_paises_block bloco 0 - 254
2025-11-24T16:44:47.006-03:00  INFO 2716 --- [cnpj-batch] [pool-6-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-6-thread-1] Finalizado bloco proc_merge_paises intervalo [0 - 254] em 24 ms (0 segundos)
2025-11-24T16:44:47.007-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_paises
2025-11-24T16:44:47.008-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_qualificacoes] para anoMes=2025-11
2025-11-24T16:44:47.011-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_qualificacoes de forma paralela | stage=stage_qualificacoes | total=68 registros | passo=2000000 | threads=2
2025-11-24T16:44:47.011-03:00  INFO 2716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Iniciando bloco proc_merge_qualificacoes (stage_qualificacoes) intervalo [0 - 67]
2025-11-24T16:44:47.019-03:00  INFO 2716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_qualificacoes_block com bloco 0 - 67
2025-11-24T16:44:47.037-03:00  INFO 2716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_qualificacoes_block bloco 0 - 67
2025-11-24T16:44:47.038-03:00  INFO 2716 --- [cnpj-batch] [pool-7-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-7-thread-1] Finalizado bloco proc_merge_qualificacoes intervalo [0 - 67] em 27 ms (0 segundos)
2025-11-24T16:44:47.038-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_qualificacoes
2025-11-24T16:44:47.038-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Iniciando execução paralela da procedure [proc_merge_empresa] para anoMes=2025-11
2025-11-24T16:45:39.244-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Executando proc_merge_empresa de forma paralela | stage=stage_empresa | total=65277300 registros | passo=2000000 | threads=2
2025-11-24T16:45:39.245-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [0 - 1999999]
2025-11-24T16:45:39.245-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [2000000 - 3999999]
2025-11-24T16:45:39.269-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 2000000 - 3999999
2025-11-24T16:45:39.281-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 0 - 1999999
2025-11-24T16:50:46.000-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 2000000 - 3999999
2025-11-24T16:50:46.012-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Finalizado bloco proc_merge_empresa intervalo [2000000 - 3999999] em 306767 ms (306 segundos)
2025-11-24T16:50:46.012-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [4000000 - 5999999]
2025-11-24T16:50:46.031-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 4000000 - 5999999
2025-11-24T16:51:51.456-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 0 - 1999999
2025-11-24T16:51:51.467-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Finalizado bloco proc_merge_empresa intervalo [0 - 1999999] em 372222 ms (372 segundos)
2025-11-24T16:51:51.468-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [6000000 - 7999999]
2025-11-24T16:51:51.482-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 6000000 - 7999999
2025-11-24T17:07:01.449-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 4000000 - 5999999
2025-11-24T17:07:01.478-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Finalizado bloco proc_merge_empresa intervalo [4000000 - 5999999] em 975466 ms (975 segundos)
2025-11-24T17:07:01.478-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [8000000 - 9999999]
2025-11-24T17:07:02.105-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 8000000 - 9999999
2025-11-24T17:20:33.186-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 6000000 - 7999999
2025-11-24T17:20:33.202-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Finalizado bloco proc_merge_empresa intervalo [6000000 - 7999999] em 1721734 ms (1721 segundos)
2025-11-24T17:20:33.202-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [10000000 - 11999999]
2025-11-24T17:20:33.245-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 10000000 - 11999999
2025-11-24T17:39:21.057-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 8000000 - 9999999
2025-11-24T17:39:21.075-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Finalizado bloco proc_merge_empresa intervalo [8000000 - 9999999] em 1939597 ms (1939 segundos)
2025-11-24T17:39:21.075-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [12000000 - 13999999]
2025-11-24T17:39:21.136-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 12000000 - 13999999
2025-11-24T17:54:54.196-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 10000000 - 11999999
2025-11-24T17:54:54.220-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Finalizado bloco proc_merge_empresa intervalo [10000000 - 11999999] em 2061018 ms (2061 segundos)
2025-11-24T17:54:54.220-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [14000000 - 15999999]
2025-11-24T17:54:54.739-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 14000000 - 15999999
2025-11-24T18:15:06.291-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 12000000 - 13999999
2025-11-24T18:15:06.309-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Finalizado bloco proc_merge_empresa intervalo [12000000 - 13999999] em 2145234 ms (2145 segundos)
2025-11-24T18:15:06.310-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [16000000 - 17999999]
2025-11-24T18:15:06.376-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 16000000 - 17999999
2025-11-24T18:33:29.312-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 14000000 - 15999999
2025-11-24T18:33:29.331-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Finalizado bloco proc_merge_empresa intervalo [14000000 - 15999999] em 2315111 ms (2315 segundos)
2025-11-24T18:33:29.331-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [18000000 - 19999999]
2025-11-24T18:33:29.387-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 18000000 - 19999999
2025-11-24T18:54:42.166-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 16000000 - 17999999
2025-11-24T18:54:42.187-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Finalizado bloco proc_merge_empresa intervalo [16000000 - 17999999] em 2375877 ms (2375 segundos)
2025-11-24T18:54:42.188-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-2] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [20000000 - 21999999]
2025-11-24T18:54:42.224-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-2] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 20000000 - 21999999
2025-11-24T19:14:06.900-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Concluído proc_merge_empresa_block bloco 18000000 - 19999999
2025-11-24T19:14:06.921-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Finalizado bloco proc_merge_empresa intervalo [18000000 - 19999999] em 2437590 ms (2437 segundos)
2025-11-24T19:14:06.922-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.m.MergeOrchestrationService    : [THREAD pool-8-thread-1] Iniciando bloco proc_merge_empresa (stage_empresa) intervalo [22000000 - 23999999]
2025-11-24T19:14:07.033-03:00  INFO 2716 --- [cnpj-batch] [pool-8-thread-1] b.c.s.c.s.merge.MergeExecutorService     : Executando proc_merge_empresa_block com bloco 22000000 - 23999999
2025-11-24T19:14:58.026-03:00  INFO 2716 --- [cnpj-batch] [RMI TCP Connection(158)-127.0.0.1] inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
2025-11-24T19:14:58.029-03:00  INFO 2716 --- [cnpj-batch] [RMI TCP Connection(158)-127.0.0.1] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-11-24T19:15:28.052-03:00  INFO 2716 --- [cnpj-batch] [RMI TCP Connection(158)-127.0.0.1] o.s.c.support.DefaultLifecycleProcessor  : Shutdown phase 2147482623 ends with 1 bean still running after timeout of 30000ms: [webServerGracefulShutdown]
2025-11-24T19:15:28.053-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] b.c.s.c.s.m.MergeOrchestrationService    : Todas as threads finalizaram corretamente para procedure proc_merge_empresa
2025-11-24T19:15:28.054-03:00 ERROR 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.tasklet.TaskletStep  : Thread interrupted while locking for repository update
2025-11-24T19:15:28.064-03:00  INFO 2716 --- [cnpj-batch] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown aborted with one or more requests still active
2025-11-24T19:15:28.193-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.s.ThreadStepInterruptionPolicy   : Step interrupted through Thread API
2025-11-24T19:15:28.195-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Encountered interruption executing step mergeStep in job cnpjJob : Job interrupted status detected.
2025-11-24T19:15:28.198-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.step.AbstractStep         : Step: [mergeStep] executed in 2h30m41s531ms
2025-11-24T19:15:28.431-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.batch.core.job.AbstractJob           : Encountered interruption executing job: Job interrupted by step execution
2025-11-24T19:15:28.532-03:00  INFO 2716 --- [cnpj-batch] [http-nio-8080-exec-1] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=cnpjJob]] completed with the following parameters: [{'anoMes':'{value=2025-11, type=class java.lang.String, identifying=true}','startAt':'{value=1764013486551, type=class java.lang.Long, identifying=true}'}] and the following status: [STOPPED] in 2h30m41s808ms
2025-11-24T19:15:28.566-03:00  INFO 2716 --- [cnpj-batch] [RMI TCP Connection(158)-127.0.0.1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T19:15:28.569-03:00  INFO 2716 --- [cnpj-batch] [RMI TCP Connection(158)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-11-24T19:15:28.572-03:00  INFO 2716 --- [cnpj-batch] [RMI TCP Connection(158)-127.0.0.1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-11-24T19:15:28.576-03:00  WARN 2716 --- [cnpj-batch] [pool-8-thread-1] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@328ad35f marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T19:15:28.576-03:00  WARN 2716 --- [cnpj-batch] [pool-8-thread-2] com.zaxxer.hikari.pool.ProxyConnection   : HikariPool-1 - Connection org.postgresql.jdbc.PgConnection@35add773 marked as broken because of SQLSTATE(08006), ErrorCode(0)

org.postgresql.util.PSQLException: An I/O error occurred while sending to the backend.
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:399) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:525) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157) ~[postgresql-42.7.8.jar:42.7.8]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-6.3.3.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.3.jar:na]
	at org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1016) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:1026) ~[spring-jdbc-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:41) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.net.SocketException: Socket closed
	at java.base/sun.nio.ch.NioSocketImpl.endRead(NioSocketImpl.java:243) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346) ~[na:na]
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796) ~[na:na]
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099) ~[na:na]
	at org.postgresql.core.VisibleBufferedInputStream.readMore(VisibleBufferedInputStream.java:192) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:159) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.ensureBytes(VisibleBufferedInputStream.java:144) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.VisibleBufferedInputStream.read(VisibleBufferedInputStream.java:76) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.PGStream.receiveChar(PGStream.java:477) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2175) ~[postgresql-42.7.8.jar:42.7.8]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372) ~[postgresql-42.7.8.jar:42.7.8]
	... 28 common frames omitted

2025-11-24T19:15:28.594-03:00 ERROR 2716 --- [cnpj-batch] [pool-8-thread-2] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

2025-11-24T19:15:28.594-03:00 ERROR 2716 --- [cnpj-batch] [pool-8-thread-1] o.s.t.i.TransactionInterceptor           : Application exception overridden by rollback exception

org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:639) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:374) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.batch.service.BatchProcessLogService$$SpringCGLIB$$0.error(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService.executarBloco(MergeExecutorService.java:47) ~[classes/:na]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.12.jar:6.2.12]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.12.jar:6.2.12]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeExecutorService$$SpringCGLIB$$0.executarBloco(<generated>) ~[classes/:na]
	at br.com.simplificarest.cnpjbatch.service.merge.MergeOrchestrationService.lambda$1(MergeOrchestrationService.java:85) ~[classes/:na]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
Caused by: java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.internal.SessionFactoryImpl.validateNotClosed(SessionFactoryImpl.java:701) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:759) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.hibernate.internal.SessionFactoryImpl.createEntityManager(SessionFactoryImpl.java:167) ~[hibernate-core-6.6.33.Final.jar:6.6.33.Final]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createNativeEntityManager(AbstractEntityManagerFactoryBean.java:594) ~[spring-orm-6.2.12.jar:6.2.12]
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:497) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:750) ~[spring-orm-6.2.12.jar:6.2.12]
	at jdk.proxy2/jdk.proxy2.$Proxy114.createNativeEntityManager(Unknown Source) ~[na:na]
	at org.springframework.orm.jpa.JpaTransactionManager.createEntityManagerForTransaction(JpaTransactionManager.java:485) ~[spring-orm-6.2.12.jar:6.2.12]
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:410) ~[spring-orm-6.2.12.jar:6.2.12]
	... 26 common frames omitted

